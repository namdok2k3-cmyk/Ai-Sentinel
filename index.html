<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sentinel: Enterprise Edition</title>
    
    <!-- Core Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Animation & Charts -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap');
        
        :root {
            /* FORCE DARK MODE VARIABLES BY DEFAULT */
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #0ea5e9;
            --accent: #8b5cf6;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            
            /* Dark Theme Colors mapped to Root */
            --surface: #1e293b;
            --background: #0f172a;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--background); 
            color: var(--text-main);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Glassmorphism */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
        }

        /* Animations */
        @keyframes scanline {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(500%); opacity: 0; }
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 0.3; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }

        @keyframes blink-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .pulse-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid var(--danger);
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background-color: var(--danger);
            border-radius: 50%;
            display: inline-block;
            animation: blink-red 1.5s infinite;
        }

        /* Tooltip Container */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 260px;
            background-color: #0f172a;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 50;
            bottom: 140%;
            left: 50%;
            margin-left: -130px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            font-weight: normal;
            pointer-events: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #0f172a transparent transparent transparent;
        }
        
        .text-highlight-hype { background-color: rgba(234, 179, 8, 0.2); border-bottom: 2px solid #eab308; color: #fef08a; }
        .text-highlight-academic { background-color: rgba(99, 102, 241, 0.2); border-bottom: 2px solid #6366f1; color: #c7d2fe; }
        .text-highlight-corporate { background-color: rgba(14, 165, 233, 0.2); border-bottom: 2px solid #0ea5e9; color: #bae6fd; }
        .text-highlight-filler { background-color: rgba(100, 116, 139, 0.2); border-bottom: 2px solid #64748b; color: #e2e8f0; }

        /* Utility */
      .text-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            background-clip: text; /* Standard property added */
            -webkit-text-fill-color: transparent;
        }
        
      .text-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            background-clip: text; 
            -webkit-text-fill-color: transparent;
        }
        @keyframes drift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0px); } }
        @keyframes matrix-fall { 0% { transform: translateY(-100%); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(100vh); opacity: 0; } }
        @keyframes grid-move { 0% { transform: perspective(500px) rotateX(60deg) translateY(0); } 100% { transform: perspective(500px) rotateX(60deg) translateY(50px); } }

        .galaxy-bg {
            background: linear-gradient(135deg, #020617 0%, #0f172a 40%, #1e1b4b 70%, #312e81 100%);
            background-size: 400% 400%; animation: drift 30s ease infinite;
            position: fixed; inset: 0; z-index: 0;
        }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 4s infinite ease-in-out; box-shadow: 0 0 10px rgba(255, 255, 255, 0.6); }
        .data-particle { position: absolute; color: rgba(99, 102, 241, 0.3); font-family: 'JetBrains Mono', monospace; font-size: 10px; user-select: none; animation: matrix-fall linear infinite; }
        .cyber-grid {
            position: fixed; bottom: -50%; left: -50%; width: 200%; height: 100%;
            background-image: linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
            background-size: 50px 50px; animation: grid-move 20s linear infinite; z-index: 1; pointer-events: none; mask-image: linear-gradient(to top, rgba(0,0,0,1), transparent 60%);
        }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3); }
        .feature-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease; }
        .feature-card:hover { background: rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.3); transform: translateY(-5px); }
        .animate-float { animation: float 8s ease-in-out infinite; }

    </style> <!-- This is the closing tag -->
    </style>
</head>
<body class="dark">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // ==========================================
        // 1. DATASETS
        // ==========================================

        const AI_VOCABULARY = {
            academic: {
                words: ["delve", "nuanced", "multifaceted", "plethora", "myriad", "testament", "underscore", "foster", "mitigate", "elucidate", "exemplify", "curate", "intertwined", "tapestry", "realm", "landscape", "pivotal", "paramount", "intrinsic"],
                desc: "Academic/Formal",
                risk: "Medium",
                reason: "AI is heavily trained on research papers, creating a bias towards formal transitional phrases like 'delve' which are rare in casual human chat."
            },
            corporate: {
                words: ["leverage", "synergy", "paradigm", "streamline", "optimize", "robust", "holistic", "bandwidth", "alignment", "ecosystem", "scalable", "actionable", "granularity", "mission-critical", "spearhead", "ideation", "touchpoint"],
                desc: "Corporate Speak",
                risk: "High",
                reason: "LLMs prioritize 'safe', professional-sounding language often found in press releases and corporate documentation."
            },
            hype: {
                words: ["game-changing", "revolutionary", "cutting-edge", "unprecedented", "state-of-the-art", "seamless", "immersive", "empower", "unlock", "unleash", "transformative", "reimagine", "groundbreaking", "breathtaking", "stunning"],
                desc: "Marketing Hype",
                risk: "High",
                reason: "Generative models default to hyperbolic adjectives when asked to describe products, lacking the nuance of human critique."
            },
            filler: {
                words: ["it is important to note", "in conclusion", "furthermore", "moreover", "additionally", "significantly", "arguably", "undeniably", "summary", "lastly", "to summarize", "consequently", "it's worth noting"],
                desc: "Structural Filler",
                risk: "Medium",
                reason: "Models use these linguistic anchors to structure their output logic, often maintaining perfect grammar where humans would use sentence fragments."
            }
        };

        const GLOSSARY = [
            { term: "Deepfake", def: "Synthetic media (video/audio) where a person's likeness is replaced by another's using deep learning." },
            { term: "Hallucination", def: "A confident response by an AI that does not justify its data training; essentially, the AI making things up." },
            { term: "Prompt Injection", def: "A security exploit where a user manipulates an LLM's input to bypass safety filters." },
            { term: "Zero-Shot Learning", def: "An AI's ability to complete a task it wasn't explicitly trained for, based on general knowledge." },
            { term: "GAN (Generative Adversarial Network)", def: "Two neural networks contesting with each other in a game (one generates, one judges) to create realistic data." },
            { term: "Temperature", def: "A parameter in AI generation that controls randomness. High temp = creative/chaotic; Low temp = deterministic/repetitive." },
            { term: "Artifacts", def: "Visual errors in AI images, such as extra fingers, mismatched earrings, or nonsensical text." },
            { term: "Voice Cloning", def: "Using AI to analyze a short audio clip of a person and generate new speech in their voice." },
            { term: "RVC (Retrieval-based Voice Conversion)", def: "A popular technology for real-time voice changing and cloning, often used in scams." },
            { term: "Spectrogram", def: "A visual representation of the spectrum of frequencies of a signal as it varies with time." },
            { term: "Model Collapse", def: "A theoretical degeneration of AI models trained on AI-generated data, leading to loss of variety and logic." },
            { term: "Watermarking", def: "Invisible signals embedded in AI content (like C2PA) to prove origin." }
        ];

        const LIVE_THREATS = [
            { type: "AUDIO", text: "New 'Ghost' Audio Model bypassing bank voice ID in < 3s.", url: "https://www.google.com/search?q=AI+audio+voice+id+bypass+news" },
            { type: "SCAM", text: "LinkedIn Profile Scraping active: Harvesting voice samples for CEO fraud.", url: "https://www.google.com/search?q=linkedin+voice+cloning+scam" },
            { type: "VIDEO", text: "Zoom Deepfake Injection tools selling on dark web for $500.", url: "https://www.google.com/search?q=zoom+deepfake+injection+tools" },
            { type: "TEXT", text: "GPT-4 'Spear Phishing' campaigns targeting HR depts with custom resumes.", url: "https://www.google.com/search?q=AI+spear+phishing+HR" },
            { type: "SCAM", text: "WhatsApp 'Hi Mum' scam utilizing RVC v2 models globally.", url: "https://www.google.com/search?q=whatsapp+hi+mum+scam+ai" },
            { type: "MALWARE", text: "Polymorphic code generation detected in Python scripts.", url: "https://www.google.com/search?q=AI+polymorphic+malware" },
            { type: "AUDIO", text: "Celebrity voice clones used in YouTube crypto giveaways.", url: "https://www.google.com/search?q=youtube+crypto+scam+deepfake" }
        ];

        const NEWS_FEED = [
            { id: 1, tag: "SCAM ALERT", date: "Today", title: "New 'CEO Fraud' Wave", content: "Scammers are using deepfake audio on WhatsApp to impersonate executives asking for gift cards. Verification via secondary channel is mandatory.", url: "https://www.google.com/search?q=ceo+gift+card+whatsapp+scam" },
            { id: 2, tag: "UPDATE", date: "Yesterday", title: "Midjourney v7 Rumors", content: "Expected to solve the 'hand problem' entirely. We need new detection methods for skin texture and lighting consistency.", url: "https://www.google.com/search?q=midjourney+v7+hands+rumors" },
            { id: 3, tag: "SECURITY", date: "2 Days Ago", title: "Gmail AI Filters", content: "Google's new spam filters are catching 99% of simple AI-generated phishing emails. Attackers are evolving to use 'human-in-the-loop' editing.", url: "https://www.google.com/search?q=gmail+ai+spam+filters+update" },
            { id: 4, tag: "TECH", date: "Last Week", title: "Watermarking Standards", content: "Major tech companies agree to invisible watermarking for AI content. Learn how to spot the 'C2PA' metadata in image headers.", url: "https://www.google.com/search?q=c2pa+watermarking+standards" }
        ];

       const COURSES = [
            // =========================================================================
            // 1. VISUAL FORENSICS
            // =========================================================================
            {
                id: "v1", category: "Visual Forensics", title: "101: Hand Topology & Fingers", level: "Beginner", duration: "10 min", xp: 100,
                content: [
                    "Lesson: Generative AI struggles with 'topology' (how parts connect). Humans have exactly 5 fingers. AI often generates 4, 6, or merges fingers.",
                    "Check 1: Count the fingers. Are there exactly 5?",
                    "Check 2: Look at the knuckles. AI often creates 'noodle fingers' without distinct joints.",
                    "Check 3: Grip logic. If holding a cup, do the fingers wrap around it correctly, or do they melt into the object?"
                ],
                quizzes: [
                    { question: "How many fingers does AI often render?", options: ["Exactly 5", "Random (4, 6, 7)", "Always 3", "None"], answer: 1 },
                    { question: "What is 'Noodle Finger'?", options: ["A pasta dish", "Fingers without joints/bones", "Long fingers", "Broken fingers"], answer: 1 },
                    { question: "What implies a fake grip?", options: ["Fingers melting into object", "Tight grip", "Loose grip", "Using two hands"], answer: 0 },
                    { question: "Why does AI struggle with hands?", options: ["It hates hands", "Lack of topology training", "It's too easy", "Cameras are bad"], answer: 1 },
                    { question: "What should you count first?", options: ["Toes", "Teeth", "Fingers", "Ears"], answer: 2 },
                    { question: "If a hand is hidden in a pocket...", options: ["It is definitely fake", "It is suspicious (hiding flaws)", "It is fine", "It is cold"], answer: 1 },
                    { question: "Real knuckles are:", options: ["Smooth", "Wrinkled and bumpy", "Invisible", "Square"], answer: 1 },
                    { question: "Fingernails in AI often look:", options: ["Perfect", "Missing or mismatched", "Painted", "Long"], answer: 1 },
                    { question: "A hand passing through a table is:", options: ["A ghost", "Physics clipping error (AI)", "Magic", "A camera trick"], answer: 1 },
                    { question: "Topology refers to:", options: ["Maps", "The study of connectivity", "Top hats", "Colors"], answer: 1 }
                ]
            },
            {
                id: "v2", category: "Visual Forensics", title: "Earrings & Symmetry", level: "Beginner", duration: "8 min", xp: 100,
                content: [
                    "Lesson: Diffusion models generate pixels locally, often forgetting global symmetry.",
                    "Check 1: Mismatched styles. Is one earring a hoop and the other a stud?",
                    "Check 2: Connection points. Does the earring actually pierce the earlobe, or does it float?",
                    "Check 3: Gravity. Heavy earrings should pull the earlobe down slightly. AI misses this physics detail."
                ],
                quizzes: [
                    { question: "What is a common jewelry error?", options: ["Too shiny", "Mismatched styles", "Too expensive", "Gold color"], answer: 1 },
                    { question: "What should heavy earrings do?", options: ["Float", "Pull the earlobe down", "Glow", "Disappear"], answer: 1 },
                    { question: "If one earring is a hoop and one is a stud...", options: ["It's fashion", "It's likely AI", "It's broken", "It's dark"], answer: 1 },
                    { question: "Check connection points to see if:", options: ["It pierces the skin", "It is glued", "It is magnetic", "It is colorful"], answer: 0 },
                    { question: "AI generates pixels based on:", options: ["Global logic", "Local context", "Perfect math", "History"], answer: 1 },
                    { question: "Symmetry errors are common in:", options: ["Photography", "Diffusion models", "Real life", "Mirrors"], answer: 1 },
                    { question: "Floating jewelry indicates:", options: ["Magic", "AI generation", "Invisible string", "Wind"], answer: 1 },
                    { question: "Glasses frames should be:", options: ["Symmetrical", "Different shapes", "Broken", "Liquid"], answer: 0 },
                    { question: "If a necklace blurs into the neck:", options: ["It's a choker", "It's an AI artifact", "It's skin paint", "It's a tattoo"], answer: 1 },
                    { question: "Global symmetry refers to:", options: ["The whole image matching", "The world", "Circles", "Colors"], answer: 0 }
                ]
            },
            {
                id: "v3", category: "Visual Forensics", title: "Eye Reflections (Catchlights)", level: "Advanced", duration: "15 min", xp: 200,
                content: [
                    "Lesson: The eyes are mirrors. They must reflect the same world.",
                    "Check 1: Shape. If the reflection in the left eye is square (window), the right eye must also be square.",
                    "Check 2: Light source. If the sun is on the left, reflections should align.",
                    "Check 3: Pupil shape. AI sometimes generates non-circular (jagged) pupils."
                ],
                quizzes: [
                    { question: "Catchlights are:", options: ["Flashlights", "Reflections in the eye", "Sun glasses", "Lasers"], answer: 1 },
                    { question: "Reflections in both eyes must:", options: ["Be different", "Match", "Be colors", "Be dark"], answer: 1 },
                    { question: "Square reflections usually indicate:", options: ["The sun", "A window or softbox", "The moon", "A car"], answer: 1 },
                    { question: "Irregular pupil shapes (not round) suggest:", options: ["Eye disease", "AI generation", "Contact lenses", "Fatigue"], answer: 1 },
                    { question: "If the person is outside, reflections should show:", options: ["Studio lights", "Sky/Horizon", "Darkness", "Text"], answer: 1 },
                    { question: "Zooming into eyes is:", options: ["Rude", "A standard forensic step", "Impossible", "Blurry"], answer: 1 },
                    { question: "Heterochromia (different eye colors) in AI is:", options: ["Intentional", "Often an accident", "Rare", "Always fake"], answer: 1 },
                    { question: "The 'Dead Eye' look refers to:", options: ["Glassy/unfocused look", "Closed eyes", "Sunglasses", "Red eyes"], answer: 0 },
                    { question: "Reflections should align with:", options: ["The shoes", "The light source", "The hair", "The background"], answer: 1 },
                    { question: "In deepfakes, blinking is:", options: ["Perfect", "Sometimes unnatural/rare", "Fast", "Slow"], answer: 1 }
                ]
            },
            {
                id: "v4", category: "Visual Forensics", title: "Background Text Logic", level: "Intermediate", duration: "10 min", xp: 150,
                content: [
                    "Lesson: AI treats text as shapes, not language (The 'Hieroglyph' Effect).",
                    "Check 1: Storefronts. Look at signs in the background. Do they spell real words?",
                    "Check 2: Logos. Is the logo on the shirt actually Nike/Adidas, or a weird hybrid?",
                    "Check 3: Keyboards. Laptop keys in AI images are often just random grid blobs."
                ],
                quizzes: [
                    { question: "AI sees text as:", options: ["Language", "Shapes/Textures", "Codes", "Numbers"], answer: 1 },
                    { question: "Background signs often look like:", options: ["English", "Alien Hieroglyphs", "Spanish", "Numbers"], answer: 1 },
                    { question: "Text on a curved shirt should:", options: ["Stay straight", "Warp with the fabric", "Disappear", "Change font"], answer: 1 },
                    { question: "AI generated keyboards usually have:", options: ["QWERTY layout", "Random grid blobs", "Missing keys", "ABC layout"], answer: 1 },
                    { question: "Newer models (DALL-E 3) are:", options: ["Worse at text", "Getting better at text", "Giving up", "Removing text"], answer: 1 },
                    { question: "Gibberish text is a sign of:", options: ["Dyslexia", "Generative AI", "Old cameras", "Low resolution"], answer: 1 },
                    { question: "If a book cover has no title, just squiggles:", options: ["It's minimal art", "Likely AI", "It's blurry", "It's a diary"], answer: 1 },
                    { question: "Magazine dates in AI images are:", options: ["Correct", "Often nonsensical (e.g., 2099 or 32nd)", "Standard", "Bold"], answer: 1 },
                    { question: "Street signs in AI cities often:", options: ["Direct traffic", "Point nowhere/Blank", "Have GPS", "Light up"], answer: 1 },
                    { question: "To fix text, scammers often:", options: ["Leave it", "Photoshop/Inpaint it", "Crop it out", "Blur it"], answer: 1 }
                ]
            },
            {
                id: "v5", category: "Visual Forensics", title: "Hairlines & Blending", level: "Advanced", duration: "12 min", xp: 180,
                content: [
                    "Lesson: Hair is computationally expensive. AI often 'smudges' it.",
                    "Check 1: The Root. Does the hair grow out of the scalp, or does it look pasted on?",
                    "Check 2: Floating Strands. Look for hairs that start and end nowhere.",
                    "Check 3: The Blur. AI often blurs the forehead line to hide connection errors."
                ],
                quizzes: [
                    { question: "Why is hair hard for AI?", options: ["It's the wrong color", "High complexity/strand count", "It's too long", "It moves"], answer: 1 },
                    { question: "A 'pasted on' look suggests:", options: ["A wig", "AI Generation", "Hair gel", "Bad haircut"], answer: 1 },
                    { question: "Floating hair strands are:", options: ["Magic", "Artifacts", "Dust", "Wind"], answer: 1 },
                    { question: "Excessive blurring at the hairline hides:", options: ["Wrinkles", "Connection errors", "Acne", "Sweat"], answer: 1 },
                    { question: "Individual strands should:", options: ["Merge into skin", "Have a clear start/end", "Disappear", "Change color"], answer: 1 },
                    { question: "AI beards often look:", options: ["Scruffy", "Like a solid texture/moss", "Sharp", "Wet"], answer: 1 },
                    { question: "In a windy photo, hair should:", options: ["Blow in one direction", "Go everywhere", "Stay still", "Disappear"], answer: 0 },
                    { question: "The 'crown' of the head is:", options: ["A hat", "Where hair spirals out", "The forehead", "The ears"], answer: 1 },
                    { question: "Overly shiny hair might look like:", options: ["Plastic/Helmet", "Wet hair", "Clean hair", "Metal"], answer: 0 },
                    { question: "Eyebrows in AI are often:", options: ["Missing", "Too symmetrical/painted", "Bushy", "Different colors"], answer: 1 }
                ]
            },
            {
                id: "v6", category: "Visual Forensics", title: "Subsurface Scattering (Skin)", level: "Pro", duration: "15 min", xp: 250,
                content: [
                    "Lesson: Real skin is translucent. Light passes through it.",
                    "Check 1: Backlighting. If the sun is behind them, ears/fingers should glow red.",
                    "Check 2: Waxiness. AI skin often reflects light like plastic (opaque).",
                    "Check 3: Pores. Zoom in. Real skin has irregular texture. AI skin is often smoothed noise."
                ],
                quizzes: [
                    { question: "Subsurface Scattering (SSS) refers to:", options: ["Scattering of ants", "Light penetrating skin", "Reflection", "Shadows"], answer: 1 },
                    { question: "Backlit ears should appear:", options: ["Black", "Glowing Red", "White", "Blue"], answer: 1 },
                    { question: "Opaque skin looks like:", options: ["Water", "Wax/Plastic", "Glass", "Cloth"], answer: 1 },
                    { question: "Real skin texture is:", options: ["Perfectly smooth", "Irregular/Porous", "Grid-like", "Pixelated"], answer: 1 },
                    { question: "AI skin often lacks:", options: ["Color", "Micro-imperfections", "Shape", "Lighting"], answer: 1 },
                    { question: "The 'Uncanny Valley' feels:", options: ["Comfortable", "Eerie/Wrong", "Happy", "Exciting"], answer: 1 },
                    { question: "Over-smoothed skin indicates:", options: ["Good makeup", "Denoising/AI", "Youth", "Sunlight"], answer: 1 },
                    { question: "Freckles in AI are often:", options: ["Real", "Pixel artifacts/Too round", "Missing", "Dark"], answer: 1 },
                    { question: "Wrinkles in AI often:", options: ["Deepen", "End randomly/don't follow muscles", "Look real", "Disappear"], answer: 1 },
                    { question: "Velvet-like skin texture is a sign of:", options: ["Midjourney v4", "Real photography", "Sweat", "Oil"], answer: 0 }
                ]
            },
            {
                id: "v7", category: "Visual Forensics", title: "Shadows & Lighting Physics", level: "Advanced", duration: "12 min", xp: 180,
                content: [
                    "Lesson: Light travels in straight lines. Shadows must converge to the source.",
                    "Check 1: Direction. Are face shadows going left, but floor shadows going right?",
                    "Check 2: Contact Shadows. Do feet touch the ground, or are they floating (missing shadow)?",
                    "Check 3: Consistency. Is the subject lit by 'soft' light but the background is 'hard' sunlight?"
                ],
                quizzes: [
                    { question: "Shadows must align with:", options: ["The moon", "The light source", "The camera", "The shoes"], answer: 1 },
                    { question: "Conflicting shadow directions imply:", options: ["Multiple suns", "Composite/AI image", "Mirrors", "Clouds"], answer: 1 },
                    { question: "A 'Contact Shadow' is found:", options: ["On the face", "Where object meets ground", "In the sky", "On walls"], answer: 1 },
                    { question: "Floating feet indicate:", options: ["Jumping", "Missing contact shadows", "Running", "Dancing"], answer: 1 },
                    { question: "Hard light creates:", options: ["Blurry edges", "Sharp/Crisp shadows", "No shadows", "Colors"], answer: 1 },
                    { question: "Soft light creates:", options: ["Darkness", "Diffused/Gradual shadows", "Sharp lines", "Spots"], answer: 1 },
                    { question: "If a face is bright but the room is dark:", options: ["It's a spotlight", "Lighting mismatch", "It's night", "It's day"], answer: 1 },
                    { question: "Impossible shadows violate:", options: ["Physics", "Chemistry", "Biology", "Math"], answer: 0 },
                    { question: "Global Illumination is:", options: ["A conspiracy", "How light bounces in a scene", "A lightbulb", "The sun"], answer: 1 },
                    { question: "Inconsistent weather (rain vs sun) suggests:", options: ["A storm", "Image manipulation", "Rainbows", "Wind"], answer: 1 }
                ]
            },

            // =========================================================================
            // 2. AUDIO FORENSICS
            // =========================================================================
            {
                id: "a1", category: "Audio Defense", title: "Breathing & Pauses", level: "Essential", duration: "8 min", xp: 150,
                content: [
                    "Lesson: Humans need oxygen. AI does not.",
                    "Check 1: Intake Breaths. Listen for the subtle 'hhaaa' before a long sentence.",
                    "Check 2: Pause Duration. AI creates 'absolute silence' between words. Real recordings have 'room tone' (air conditioner, wind).",
                    "Check 3: Sentence Length. AI can speak for 60 seconds without breathing. Humans can't."
                ],
                quizzes: [
                    { question: "Humans breath every:", options: ["30 seconds", "4-8 seconds", "2 minutes", "Never"], answer: 1 },
                    { question: "Absolute silence between words suggests:", options: ["A good mic", "Digital generation/gating", "A quiet room", "Whispering"], answer: 1 },
                    { question: "Room Tone is:", options: ["Music", "Background noise floor", "Wall color", "Volume"], answer: 1 },
                    { question: "Continuous speech without breath is:", options: ["Impressive", "Physiologically impossible", "Singing", "Rapping"], answer: 1 },
                    { question: "Micro-pauses are:", options: ["Mistakes", "Natural thinking time", "Glitches", "Edits"], answer: 1 },
                    { question: "If the audio cuts to 'Dead Air':", options: ["It's spliced/AI", "The mic broke", "They stopped", "Signal lost"], answer: 0 },
                    { question: "Inhale sounds are:", options: ["Annoying", "Proof of lungs/life", "Loud", "Scary"], answer: 1 },
                    { question: "TTS stands for:", options: ["Text To Speech", "Time To Sleep", "Talk To Scammers", "True Tone Sound"], answer: 0 },
                    { question: "A continuous 45-second sentence is:", options: ["A run-on sentence", "A red flag for AI", "Poetry", "Fast talking"], answer: 1 },
                    { question: "Natural speech has:", options: ["Uniform rhythm", "Variable rhythm", "No rhythm", "Perfect beat"], answer: 1 }
                ]
            },
            {
                id: "a2", category: "Audio Defense", title: "Metallic Artifacts (Vocoding)", level: "Advanced", duration: "12 min", xp: 200,
                content: [
                    "Lesson: AI reconstitutes audio from data, often leaving a 'robotic' residue.",
                    "Check 1: The Shimmer. Listen to 'S' and 'F' sounds. Do they sound like a metal fan?",
                    "Check 2: End of Sentence. Artifacts often appear at the tail end of a word as the model stops generating.",
                    "Check 3: Bitrate drops. Does the voice suddenly sound like a bad cell connection for 0.5 seconds?"
                ],
                quizzes: [
                    { question: "Vocoder artifacts sound like:", options: ["Drums", "Metallic buzzing/Shimmer", "Birds", "Water"], answer: 1 },
                    { question: "Sibilance refers to:", options: ["Loud noises", "'S' and 'F' sounds", "Silence", "Bass"], answer: 1 },
                    { question: "Artifacts often appear:", options: ["At the start", "At the tail/end of words", "In the middle", "Never"], answer: 1 },
                    { question: "Sudden quality drops indicate:", options: ["Wind", "Model processing errors", "Bad phone", "Distance"], answer: 1 },
                    { question: "A 'Phasey' sound is:", options: ["Swirling/Watery", "Clear", "Loud", "Deep"], answer: 0 },
                    { question: "High frequency buzzing is:", options: ["Normal", "A compression/AI artifact", "Tinnitus", "Radio"], answer: 1 },
                    { question: "Robotic sounding vowels suggest:", options: ["Autotune/AI", "Accents", "Singing", "Colds"], answer: 0 },
                    { question: "Low bitrate audio sounds:", options: ["Crisp", "Muffled/Underwater", "Fast", "Slow"], answer: 1 },
                    { question: "Spectral analysis visualizes:", options: ["Colors", "Frequencies over time", "Volume only", "Words"], answer: 1 },
                    { question: "Mel-spectrograms are used to:", options: ["Train Audio AI", "Play music", "Record video", "Type text"], answer: 0 }
                ]
            },
            {
                id: "a3", category: "Audio Defense", title: "Emotional Mismatch", level: "Intermediate", duration: "10 min", xp: 150,
                content: [
                    "Lesson: AI models clone timbre (voice sound) but struggle with prosody (emotional delivery).",
                    "Check 1: Panic vs Tone. Script: 'Help I'm kidnapped!' Tone: Flat, bored, reading a list.",
                    "Check 2: Laughter. AI laughter is repetitive and doesn't affect the breath of the following words.",
                    "Check 3: Micro-tremors. Fear causes voice shaking. AI voices are often perfectly steady."
                ],
                quizzes: [
                    { question: "Prosody refers to:", options: ["Pronunciation", "Rhythm, stress, and intonation", "Volume", "Speed"], answer: 1 },
                    { question: "A 'flat' tone in an emergency call is:", options: ["Brave", "Suspicious/AI", "Calm", "Professional"], answer: 1 },
                    { question: "AI laughter often sounds:", options: ["Joyful", "Mechanical/Repetitive", "Loud", "Quiet"], answer: 1 },
                    { question: "Real laughter affects:", options: ["Nothing", "The breathing/speech after it", "The phone", "The signal"], answer: 1 },
                    { question: "Voice tremors indicate:", options: ["Cold", "Fear/Stress", "Hunger", "Sleep"], answer: 1 },
                    { question: "Perfect pitch stability is:", options: ["Human", "Robotic", "Musical", "Natural"], answer: 1 },
                    { question: "If the words say 'Angry' but the voice says 'Calm':", options: ["They are acting", "Emotional Mismatch (AI)", "They are crazy", "It is sarcasm"], answer: 1 },
                    { question: "Screaming is hard for AI because:", options: ["It hurts", "Training data usually lacks screaming", "It is loud", "It breaks speakers"], answer: 1 },
                    { question: "Irony and Sarcasm are:", options: ["Easy for AI", "Difficult/Context dependent", "Impossible", "Common"], answer: 1 },
                    { question: "Timbre refers to:", options: ["Time", "The unique texture of a voice", "Volume", "Pitch"], answer: 1 }
                ]
            },
            {
                id: "a4", category: "Audio Defense", title: "Latency & Interruptions", level: "Pro", duration: "15 min", xp: 250,
                content: [
                    "Lesson: Real-time Voice Changers (RVC) need processing time.",
                    "Check 1: The Delay. Ask a rapid math question ('What is 5 plus 7?'). A human answers instantly. RVC has a lag.",
                    "Check 2: Interruption. Talk OVER them. The AI model will get confused or keep playing its buffer.",
                    "Check 3: The Glitch. When the AI fails, you might hear the scammer's real voice for a millisecond."
                ],
                quizzes: [
                    { question: "RVC stands for:", options: ["Real Voice Call", "Retrieval-based Voice Conversion", "Robotic Voice Code", "Remote Video Control"], answer: 1 },
                    { question: "Latency is:", options: ["Volume", "Delay in processing", "Pitch", "Speed"], answer: 1 },
                    { question: "To test latency, ask:", options: ["A story", "A rapid calculation/question", "A long question", "Nothing"], answer: 1 },
                    { question: "Interrupting a deepfake often causes:", options: ["Anger", "Glitches/Audio overlap errors", "Silence", "Laughter"], answer: 1 },
                    { question: "If the voice changes for a split second:", options: ["It's a mask slip", "It's the wind", "It's a cough", "It's fine"], answer: 0 },
                    { question: "Live conversion requires:", options: ["No power", "GPU Processing", "Nothing", "Paper"], answer: 1 },
                    { question: "Buffer lag sounds like:", options: ["Echo", "Awkward silence before answering", "Static", "Music"], answer: 1 },
                    { question: "Overlapping speech (Talking over) is:", options: ["Polite", "Hard for AI to process", "Easy", "Quiet"], answer: 1 },
                    { question: "A 'Mask Slip' reveals:", options: ["The face", "The original voice", "The IP", "The location"], answer: 1 },
                    { question: "Low latency is:", options: ["Bad", "Good/Fast", "Slow", "Loud"], answer: 1 }
                ]
            },

            // =========================================================================
            // 3. TEXT ANALYSIS
            // =========================================================================
            {
                id: "t1", category: "Text Analysis", title: "The 'Delve' Index (Vocabulary)", level: "Beginner", duration: "8 min", xp: 100,
                content: [
                    "Lesson: LLMs (ChatGPT/Claude) are over-trained on academic papers and corporate press releases.",
                    "Check 1: The Words. 'Delve', 'Underscore', 'Landscape', 'Tapestry', 'Nuanced'.",
                    "Check 2: Frequency. Humans use 'delve' rarely. AI uses it constantly.",
                    "Check 3: Adjectives. 'Game-changing', 'Revolutionary', 'Seamless'. (Hype language)."
                ],
                quizzes: [
                    { question: "Which word is an AI hallmark?", options: ["Run", "Delve", "Eat", "Sleep"], answer: 1 },
                    { question: "LLMs are trained on:", options: ["Street slang", "Academic/Corporate text", "Baby talk", "Nothing"], answer: 1 },
                    { question: "High frequency of 'Tapestry' suggests:", options: ["Weaving", "AI generation", "History", "Art"], answer: 1 },
                    { question: "'Game-changing' is:", options: ["Hype adjective", "A verb", "A noun", "Slang"], answer: 0 },
                    { question: "Humans usually say 'dig into' instead of:", options: ["Run", "Delve", "Jump", "Fly"], answer: 1 },
                    { question: "RLHF stands for:", options: ["Real Life Has Fun", "Reinforcement Learning from Human Feedback", "Robots Love Human Friends", "Red Light High Frequency"], answer: 1 },
                    { question: "A 'Nuanced' take is:", options: ["Simple", "Complex/Subtle (AI favorite)", "Wrong", "Loud"], answer: 1 },
                    { question: "Overuse of 'Seamless' implies:", options: ["Clothing", "Marketing/AI text", "Broken", "Rough"], answer: 1 },
                    { question: "Vocabulary bias comes from:", options: ["The Training Data", "The user", "The keyboard", "The screen"], answer: 0 },
                    { question: "To sound human, use:", options: ["Slang/Idioms", "Latin", "Formal codes", "Buzzwords"], answer: 0 }
                ]
            },
            {
                id: "t2", category: "Text Analysis", title: "Lack of Opinion (The Hedge)", level: "Intermediate", duration: "10 min", xp: 120,
                content: [
                    "Lesson: AI is trained to be neutral and safe. It hates taking a hard stance.",
                    "Check 1: The Hedge. 'It is important to consider...', 'While X is good, Y is also...'",
                    "Check 2: Definitive statements. A human says 'This movie sucks'. AI says 'The movie has received mixed reviews...'.",
                    "Check 3: Moralizing. 'It is crucial to prioritize safety...' (Preachy tone)."
                ],
                quizzes: [
                    { question: "Hedging means:", options: ["Gardening", "Avoiding a direct stance", "Betting", "Jumpinig"], answer: 1 },
                    { question: "AI is trained to be:", options: ["Rude", "Neutral/Safe", "Angry", "Sad"], answer: 1 },
                    { question: "A strong opinion like 'I hate this' is:", options: ["Likely Human", "Likely AI", "Impossible", "Rare"], answer: 0 },
                    { question: "Moralizing text sounds:", options: ["Fun", "Preachy/Lecture-like", "Fast", "Quiet"], answer: 1 },
                    { question: "'It is important to note' is:", options: ["A filler phrase", "A command", "A question", "A lie"], answer: 0 },
                    { question: "AI avoids:", options: ["Facts", "Controversy/Bias", "Grammar", "Spelling"], answer: 1 },
                    { question: "Bothsidesism is:", options: ["Arguing for both sides (AI trait)", "A sport", "A game", "Cooking"], answer: 0 },
                    { question: "Subjectivity is:", options: ["Personal opinion", "Objective fact", "Math", "Science"], answer: 0 },
                    { question: "Safety filters cause AI to:", options: ["Swear", "Refuse/Lecture", "Cry", "Sleep"], answer: 1 },
                    { question: "To test for AI, ask for:", options: ["A math problem", "A controversial opinion", "A definition", "A summary"], answer: 1 }
                ]
            },
            {
                id: "t3", category: "Text Analysis", title: "Structure & Uniformity", level: "Intermediate", duration: "10 min", xp: 150,
                content: [
                    "Lesson: AI loves structure. Humans are chaotic.",
                    "Check 1: Lists. AI almost always defaults to bullet points or numbered lists.",
                    "Check 2: Sentence Length. AI sentences are often uniform length (medium-medium-medium). Humans vary (Short. Very long complex sentence. Short).",
                    "Check 3: Connectors. 'Furthermore', 'Moreover', 'In conclusion'. Humans rarely use these in texts/emails."
                ],
                quizzes: [
                    { question: "AI defaults to:", options: ["Paragraphs", "Lists/Bullet points", "Poems", "Songs"], answer: 1 },
                    { question: "Human sentence length is:", options: ["Uniform", "Variable/Chaotic", "Always long", "Always short"], answer: 1 },
                    { question: "'Furthermore' is:", options: ["Casual", "Formal connector", "Slang", "Insult"], answer: 1 },
                    { question: "In a text message, perfect grammar is:", options: ["Normal", "Suspicious", "Required", "Bad"], answer: 1 },
                    { question: "Burstiness measures:", options: ["Explosions", "Variation in sentence structure", "Speed", "Volume"], answer: 1 },
                    { question: "Low perplexity means:", options: ["Confusing", "Predictable (AI)", "Smart", "New"], answer: 1 },
                    { question: "A concluding summary in a short email is:", options: ["Helpful", "An AI structural habit", "Required", "Rude"], answer: 1 },
                    { question: "Uniformity looks like:", options: ["Blocks of text", "Visual noise", "Art", "Messy"], answer: 0 },
                    { question: "Humans use fragments like:", options: ["'Lol no'", "'It is imperative'", "'Consequently'", "'Therefore'"], answer: 0 },
                    { question: "Entropy in text refers to:", options: ["Heat", "Randomness/Unpredictability", "Order", "Cold"], answer: 1 }
                ]
            },

            // =========================================================================
            // 4. SCAM DEFENSE
            // =========================================================================
            {
                id: "s1", category: "Scam Defense", title: "The 'Grandparent' Scam", level: "Essential", duration: "5 min", xp: 500,
                content: [
                    "Scenario: You get a call. 'Grandma? It's me. I'm in jail. I broke my nose, that's why I sound weird.'",
                    "The Tech: Voice cloning from social media videos + emotional manipulation.",
                    "The Defense: The Safe Word. Ask 'What is the name of your first pet?' or a pre-agreed code word.",
                    "Action: Hang up. Call their real number."
                ],
                quizzes: [
                    { question: "Who is the primary target?", options: ["Teens", "Elderly/Grandparents", "Babies", "Pets"], answer: 1 },
                    { question: "Why does the voice sound weird?", options: ["Broken nose (Excuse)", "Bad signal", "Eating", "Sleeping"], answer: 0 },
                    { question: "What is the best defense?", options: ["Sending money", "The Safe Word", "Crying", "Yelling"], answer: 1 },
                    { question: "Scammers request money via:", options: ["Check", "Gift Cards/Wire/Crypto", "Cash in person", "Mail"], answer: 1 },
                    { question: "Why do they say 'Don't tell Mom'?", options: ["It's a secret", "To isolate the victim", "It's a surprise", "They are shy"], answer: 1 },
                    { question: "Where do they get the voice?", options: ["Magic", "Social Media (TikTok/Instagram)", "Movies", "Radio"], answer: 1 },
                    { question: "If you are unsure:", options: ["Pay anyway", "Hang up and call the real number", "Guess", "Wait"], answer: 1 },
                    { question: "Urgency is used to:", options: ["Help you", "Bypass critical thinking", "Save time", "Be efficient"], answer: 1 },
                    { question: "Bail bondsmen do NOT take:", options: ["Cash", "Apple Gift Cards", "Cards", "Checks"], answer: 1 },
                    { question: "Voice clones need:", options: ["Hours of audio", "Only 3 seconds of audio", "A studio", "A script"], answer: 1 }
                ]
            },
            {
                id: "s2", category: "Scam Defense", title: "CEO Fraud (Spear Phishing)", level: "Corporate", duration: "8 min", xp: 300,
                content: [
                    "Scenario: Text from the CEO. 'I'm in a meeting. Need you to buy 10 gift cards for a client presentation ASAP.'",
                    "The Tech: Spoofed numbers or AI-written emails mimicking the CEO's style.",
                    "The Defense: Channel Hopping. If the request comes via Email, confirm via Slack. If Text, confirm via Call.",
                    "Red Flag: Urgency + Gift Cards."
                ],
                quizzes: [
                    { question: "Spear Phishing targets:", options: ["Random people", "Specific individuals/Roles", "Fish", "Computers"], answer: 1 },
                    { question: "CEOs typically ask for:", options: ["Reports", "Gift Cards via WhatsApp", "Coffee", "Files"], answer: 1 },
                    { question: "The 'Urgency' tactic means:", options: ["Do it fast/Don't think", "Take your time", "Plan ahead", "Be slow"], answer: 0 },
                    { question: "Channel Hopping means:", options: ["Changing TV channels", "Verifying on a different platform", "Swimming", "Jumping"], answer: 1 },
                    { question: "Spoofed numbers look like:", options: ["Fake numbers", "The real number/Local codes", "Letters", "Symbols"], answer: 1 },
                    { question: "If the CEO is 'in a meeting':", options: ["Do not disturb", "It's a common excuse to avoid a call", "Wait", "Go in"], answer: 1 },
                    { question: "Business payments are made via:", options: ["Invoice/Procurement", "Steam Gift Cards", "Cash app", "Venmo"], answer: 0 },
                    { question: "AI helps scammers by:", options: ["Writing perfect/persuasive scripts", "Making coffee", "Driving", "Calling"], answer: 0 },
                    { question: "Social Engineering hacks:", options: ["Computers", "Humans", "Phones", "Doors"], answer: 1 },
                    { question: "Always verify requests involving:", options: ["Lunch", "Money/Data", "Meetings", "Paper"], answer: 1 }
                ]
            },
            {
                id: "s3", category: "Scam Defense", title: "Pig Butchering (Crypto Romance)", level: "Advanced", duration: "15 min", xp: 500,
                content: [
                    "Scenario: A 'wrong number' text turns into a friendship/romance. They are wealthy and trade Crypto.",
                    "The Tech: Deepfake profile photos, AI-translated chat scripts.",
                    "The Process: Fattening (Building trust) -> Butchering (Stealing all funds via a fake exchange app).",
                    "Red Flag: They refuse to video call, or the video call loops."
                ],
                quizzes: [
                    { question: "Pig Butchering refers to:", options: ["Farming", "Fattening a victim before theft", "Cooking", "Hunting"], answer: 1 },
                    { question: "It starts with:", options: ["A threat", "A 'wrong number' or romance", "A bill", "A letter"], answer: 1 },
                    { question: "The scammer usually claims to be:", options: ["Poor", "Wealthy/Successful investor", "A student", "A doctor"], answer: 1 },
                    { question: "The fake trading app shows:", options: ["Real losses", "Fake massive profits", "Nothing", "News"], answer: 1 },
                    { question: "When you try to withdraw money:", options: ["It works", "They ask for 'taxes' or fees", "It doubles", "It vanishes"], answer: 1 },
                    { question: "They avoid video calls because:", options: ["They are shy", "They are fake/using AI photos", "Bad camera", "Sleeping"], answer: 1 },
                    { question: "If it sounds too good to be true:", options: ["You are lucky", "It is a scam", "Take it", "Invest more"], answer: 1 },
                    { question: "Scammers often move chat to:", options: ["Email", "WhatsApp/Telegram (Encrypted)", "Phone", "Mail"], answer: 1 },
                    { question: "Reverse Image Search can help:", options: ["Find the real owner of photos", "Edit photos", "Delete photos", "Save photos"], answer: 0 },
                    { question: "The 'Tax Fee' is:", options: ["Real", "A secondary scam to steal more", "Optional", "Small"], answer: 1 }
                ]
            },
            {
                id: "s4", category: "Scam Defense", title: "Quishing (QR Code Phishing)", level: "Modern", duration: "5 min", xp: 150,
                content: [
                    "Scenario: An email says '2FA Expired, Scan QR to reset'. Or a parking meter has a sticker over the real code.",
                    "The Tech: AI generates credible-looking emails. QR codes bypass email text filters.",
                    "The Defense: Check the URL preview before clicking. Inspect physical stickers.",
                    "Action: Never scan a random QR code to 'login'."
                ],
                quizzes: [
                    { question: "Quishing stands for:", options: ["Quick Fishing", "QR Phishing", "Quiet Shushing", "Quality Hishing"], answer: 1 },
                    { question: "QR codes bypass:", options: ["Cameras", "Email text scanners/filters", "Humans", "Phones"], answer: 1 },
                    { question: "Physical QR scams involve:", options: ["Painting", "Stickers over real codes", "Lasers", "Paper"], answer: 1 },
                    { question: "Before scanning, you should:", options: ["Close eyes", "Check the source/URL preview", "Run", "Pay"], answer: 1 },
                    { question: "Malicious QRs can lead to:", options: ["Candy", "Fake login sites/Malware", "Real sites", "Maps"], answer: 1 },
                    { question: "Parking meters are common targets for:", options: ["Coins", "Sticker overlays", "Graffiti", "Cleaning"], answer: 1 },
                    { question: "If an email asks to scan QR to login:", options: ["Do it", "Be highly suspicious", "Print it", "Delete it"], answer: 1 },
                    { question: "Shortened URLs (bit.ly) in QRs are:", options: ["Safe", "Risky (hides destination)", "Fast", "Cool"], answer: 1 },
                    { question: "Mobile browsers often hide:", options: ["Images", "Full URL bars", "Text", "Colors"], answer: 1 },
                    { question: "To verify, navigate to the site:", options: ["Via the QR", "Manually/Via Bookmark", "Via Google", "Via Email"], answer: 1 }
                ]
            }
        ];
        const COMPARISON_GALLERY = [
            {
                id: 1, title: "Skin Texture & Pores", realUrl: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=800&auto=format&fit=crop", aiType: "smooth", 
                description: "Real skin has pores, imperfections, and varying translucency. AI skin often looks 'airbrushed', waxy, or like plastic."
            },
            {
                id: 2, title: "Background Logic", realUrl: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=800&auto=format&fit=crop", aiType: "warped", 
                description: "Architectural Symmetry. In AI, straight lines in background buildings often warp, stairs lead to nowhere, or windows are uneven."
            },
            {
                id: 3, title: "Hands & Interactions", realUrl: "https://images.unsplash.com/photo-1596495577886-d920f1fb7238?q=80&w=800&auto=format&fit=crop", aiType: "glitch",
                description: "Topology failure. Hands holding objects often merge with the object, or fingers appear 'noodle-like' without distinct knuckles."
            },
            {
                id: 4, title: "Text & Logos", realUrl: "https://images.unsplash.com/photo-1576153192396-180ecef2a715?q=80&w=800&auto=format&fit=crop", aiType: "text_fail",
                description: "Gibberish. AI struggles to render coherent text on street signs or neon lights, often producing alien-like symbols."
            },
            {
                id: 5, title: "Symmetry & Accessories", realUrl: "https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?q=80&w=800&auto=format&fit=crop", aiType: "symmetry",
                description: "Accessories check. AI creates images holistically, often resulting in mismatched earrings or glasses frames that don't connect to ears."
            },
            {
                id: 6, title: "Reflection Logic", realUrl: "https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=800&auto=format&fit=crop", aiType: "smooth",
                description: "Environment mismatch. Reflections in eyes or water often show a different environment or light source than the main scene."
            }
        ];

        // ==========================================
        // 2. ICON SYSTEM
        // ==========================================
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Home: <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
            Eye: <><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" /><circle cx="12" cy="12" r="3" /></>,
            Search: <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
            Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
            Terminal: <><polyline points="4 17 10 11 4 5" /><line x1="12" y1="19" x2="20" y2="19" /></>,
            Book: <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />,
            Award: <><circle cx="12" cy="8" r="7" /><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" /></>,
            Upload: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></>,
            Check: <polyline points="20 6 9 17 4 12" />,
            X: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
            Moon: <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />,
            Sun: <><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></>,
            Zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,
            User: <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />,
            Target: <><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>,
            Lock: <><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>,
            Alert: <><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></>,
            Info: <circle cx="12" cy="12" r="10" />,
            FileText: <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />,
            List: <line x1="8" y1="6" x2="21" y2="6" />,
            Mic: <><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></>,
            MicOff: <line x1="1" y1="1" x2="23" y2="23" />,
            Play: <polygon points="5 3 19 12 5 21 5 3" />,
            Pause: <><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></>,
            Square: <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />,
            Trash2: <><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>,
            RefreshCw: <><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>,
            Activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />,
            ArrowRight: <><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></>,
            Globe: <><circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></>,
            ExternalLink: <><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></>,
            Wand: <><path d="M15 4V2"/><path d="M15 16v-2"/><path d="M8 9h2"/><path d="M20 9h2"/><path d="M17.8 11.8 19 13"/><path d="M15 9h0"/><path d="M17.8 6.2 19 5"/><path d="M3 21l9-9"/><path d="M12.2 6.2 11 5"/></>
        };

        // ==========================================
        // 3. UTILITY COMPONENTS
        // ==========================================
        
        const Button = ({ children, onClick, variant = 'primary', className = "", disabled = false, icon }) => {
            const baseStyle = "flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold transition-all duration-200 active:scale-95 shadow-sm";
            const variants = {
                primary: "bg-indigo-600 hover:bg-indigo-700 text-white shadow-none",
                secondary: "bg-slate-800 text-slate-200 border border-slate-700 hover:bg-slate-700",
                danger: "bg-red-500 hover:bg-red-600 text-white",
                ghost: "bg-transparent hover:bg-slate-800 text-slate-400"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`}>
                    {icon && <Icon path={icon} size={18} />}
                    {children}
                </button>
            );
        };

        const Card = ({ children, className = "", title, icon }) => (
            <div className={`glass rounded-2xl p-6 shadow-none ${className}`}>
                {(title || icon) && (
                    <div className="flex items-center gap-3 mb-4 border-b border-slate-700 pb-4">
                        {icon && <div className="p-2 bg-indigo-900/30 text-indigo-400 rounded-lg"><Icon path={icon} /></div>}
                        {title && <h3 className="font-bold text-lg text-slate-100">{title}</h3>}
                    </div>
                )}
                {children}
            </div>
        );

        const Badge = ({ children, color = 'blue' }) => {
            const colors = {
                blue: "bg-blue-900/50 text-blue-200",
                green: "bg-green-900/50 text-green-200",
                red: "bg-red-900/50 text-red-200",
                purple: "bg-purple-900/50 text-purple-200",
                orange: "bg-orange-900/50 text-orange-200"
            };
            return <span className={`px-2.5 py-0.5 rounded-full text-xs font-bold uppercase tracking-wide ${colors[color]}`}>{children}</span>;
        };

        const ProgressBar = ({ value, max = 100, color = "bg-indigo-600" }) => (
            <div className="w-full bg-slate-700 rounded-full h-2.5 overflow-hidden">
                <div className={`h-2.5 rounded-full transition-all duration-1000 ${color}`} style={{ width: `${(value / max) * 100}%` }}></div>
            </div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in">
                    <div className="bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border border-slate-700">
                        <div className="p-6 border-b border-slate-800 flex justify-between items-center sticky top-0 bg-slate-900 z-10">
                            <h3 className="text-xl font-bold text-white">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-slate-800 rounded-full text-white"><Icon path={Icons.X} /></button>
                        </div>
                        <div className="p-6">{children}</div>
                    </div>
                </div>
            );
        };

        const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        };

        // ==========================================
        // 4. CORE FEATURE MODULES
        // ==========================================

// AI Prompt Optimizer
const COMMON_PROMPTS = [
  // Dating / social / texting
  "First text after matching on a dating app",
  "How to ask a girl out without sounding clingy",
  "What to text after a good first date",
  "How to apologize by text sincerely",
  "Funny opening lines for a dating app",
  "How to keep a conversation going over text",
  "How to ask someone for their number politely",
  "What to say to ask for a second date",
  "How to respond to 'what are you doing?' from a crush",
  "How to flirt over text without being creepy",
  "How to say 'I like you' without scaring them",
  "Good morning text examples",
  "How to break the ice with a shy person",
  "How to send a breakup text respectfully",
  "How to decline a date politely",
  "How to check in after a first date with no reply",
  "Short compliments that don't sound creepy",
  "How to ask for a video call smoothly",
  "Text message to follow up after exchanging numbers",
  "How to ask someone out for coffee casually",
  "How to suggest meeting at an event",
  "What to text if you want to be friends with benefits",
  "How to express interest after a long pause in chat",
  "How to ask for consent politely in messages",
  "How to flirt using humor in text",
  "How to recover from a bad text mistake",
  "How to introduce yourself on LinkedIn messaging",
  "How to ask a crush to hang out this weekend",
  "How to ask her/him about relationship status without being invasive",
  "How to politely ask someone to stop texting late at night",
  "How to propose a date idea via text",
  // Career / job / recruiting
  "Write a cover letter for a software engineering internship (1216 months)",
  "How to cold email a recruiter for an internship",
  "Follow-up email after job interview template",
  "How to ask for a referral from a former colleague",
  "How to negotiate salary after an offer",
  "How to ask for feedback after rejection",
  "Write a CV for a computer science student",
  "What to put in a resume for first industry job",
  "How to ask a manager for flexible hours",
  "How to write a professional apology to a manager",
  "How to ask for more responsibility at work",
  "How to request a reference letter from a professor",
  "How to pitch yourself for a co-op role",
  "Professional LinkedIn message to recruiters",
  "How to prepare for a behavioral interview",
  "STAR method answer for 'Tell me about a time you failed'",
  "How to create a professional summary for LinkedIn",
  "How to ask for an internship extension",
  // Code / debugging / engineering
  "Write a React component that fetches data and shows loading/error",
  "How to fix 'Cannot read property of undefined' in JS",
  "Explain async/await vs promises for beginners",
  "Python function to clean CSV and export JSON",
  "SQL query to deduplicate rows keeping newest",
  "How to write unit tests in Jest for a function",
  "How to debug a memory leak in Node.js",
  "How to optimize a slow SQL query",
  "How to implement pagination in REST API",
  "How to implement exponential backoff in HTTP calls",
  "Template for Git commit messages",
  "How to resolve merge conflicts in Git step-by-step",
  "How to set up CI/CD with GitHub Actions",
  "Dockerfile for Node.js app with best practices",
  "How to write a secure login endpoint",
  "How to design a database schema for a todo app",
  "How to write a migration script for Postgres",
  "How to test React hooks effectively",
  "Explain big-O complexity with an example",
  "How to implement OAuth2 for a web app",
  // Education / tutoring / explanations
  "Explain Fourier transform in simple terms",
  "Explain calculus derivative like I'm 15",
  "Step-by-step solution for this algebra problem",
  "Create a lesson plan to teach arrays in JS",
  "Summarize this article into 5 bullets",
  "Create flashcards for exam revision on OS concepts",
  "Explain reinforcement learning with an everyday analogy",
  "How to study using spaced repetition and active recall",
  "Create a 4-week study schedule for finals",
  "How to write a literature review structure",
  "How to format citations in APA style",
  "How to plan a research paper outline",
  // Writing / editing / content
  "Rewrite this paragraph to be simpler and shorter",
  "Improve tone of this professional email",
  "Write 5 subject lines for a cold outreach email",
  "Draft a product description for headphones",
  "Create 10 tweet ideas about AI ethics",
  "Write a persuasive elevator pitch for a fintech startup",
  "Create meta descriptions for an e-commerce product page",
  "Proofread and edit this cover letter for clarity",
  "Turn these notes into a one-page summary",
  "Write a short bio for a portfolio website",
  // Marketing / SEO / growth
  "Write ad copy for a paid social campaign",
  "Create A/B test ideas for onboarding flow",
  "How to write a cold outreach sequence for B2B sales",
  "Create a 7-day content calendar for Instagram",
  "List keywords for SEO for 'task management app'",
  "Draft an email drip campaign for onboarding",
  "Create 5 CTA variations for a landing page",
  "How to run a low budget user testing study",
  "How to measure product-market fit metrics",
  // Audio / voice / forensics / signal
  "How to detect zero-breath artifacts in speech",
  "How to create a spectrogram and read it",
  "How to test for metallic shimmer on sibilants",
  "Short phrases to use for voice authenticity testing",
  "How to measure pitch variance to detect synthetic voice",
  "How to do short-time energy silence detection",
  "How to extract F0 (pitch) contour from audio",
  "How to detect re-synthesis artifacts in compressed audio",
  "Checklist for recording voice evidence professionally",
  "What audio sample rate/resolution to use for forensics",
  // Security / privacy / safety
  "How to write a privacy-safe consent message for voice recordings",
  "How to explain voice cloning risks to non-technical managers",
  "Checklist for secure handling of audio evidence",
  "How to redact PII from a transcript",
  "Best practices for storing sensitive audio files",
  // Product / design / UX
  "How to design microcopy for onboarding",
  "Create a user interview guide for new feature",
  "How to write acceptance criteria for a ticket",
  "Design an accessible form that meets WCAG",
  "How to prototype a dashboard layout in Figma",
  "Create wireframe checklist for mobile app",
  "How to prioritize features using RICE",
  "Create job description for junior product manager",
  // Data / ML / AI
  "How to clean noisy dataset before training",
  "Explain model fine-tuning vs prompt tuning",
  "How to measure model bias and mitigation steps",
  "Create evaluation metrics for classification task",
  "How to create training/validation/test splits properly",
  "Explain LLM hallucination and mitigation strategies",
  "How to generate synthetic training data safely",
  // Business / strategy / operations
  "Create a one-page PR plan for product launch",
  "Write a simple GTM plan for a SaaS MVP",
  "How to project 12-month revenue with assumptions",
  "How to calculate TAM, SAM, SOM with examples",
  "How to create a simple KPI dashboard for execs",
  // Legal / compliance (high-level, non-legal-advice)
  "Checklist for GDPR-compliant user data collection (high-level)",
  "Write a short user-facing privacy snippet for audio recording",
  "High-level steps for copyright attribution best practice",
  // Health / fitness / nutrition
  "Create a 4-week beginner workout plan with limited equipment",
  "Non-medical diet tips to gain muscle for beginners",
  "How to track progress for a running plan",
  "How to structure a daily mindfulness practice",
  // Finance / personal money
  "How to create a monthly budget in a spreadsheet",
  "How to write an email to dispute a bank charge",
  "Explain difference between TFSA and RRSP (Canada) simply",
  "How to calculate loan monthly payments",
  // Travel / trip planning
  "Create a 3-day low-budget itinerary for Fredericton, NB",
  "How to pack light for a 7-day trip",
  "Checklist for travel insurance considerations",
  "How to find cheap flights with flexible dates",
  // Creative / art / music
  "Write a 200-word cyberpunk scene",
  "Create 8 album title ideas for indie band",
  "How to structure a short film script outline",
  "Ideas for relaxing lo-fi playlist themes",
  // Troubleshooting / how-to
  "How to reset a 2FA-locked account politely",
  "How to fix common Wi-Fi connectivity issues",
  "How to recover deleted files from a Git branch",
  "How to prepare a reproducible bug report for QA",
  // Admin / productivity
  "How to write concise meeting notes into action items",
  "Create a weekly planner template for university students",
  "Checklist for pre-launch QA testing",
  "How to set up a habit tracker for studying",
  // Templates / copy heavy
  "Write a polite customer support reply for delayed shipment",
  "Create a short apology email for a missed deadline",
  "Compose a message to ask for beta testers",
  "Write a message to ask a professor for an extension",
  // Specific technical tasks
  "SQL to find the top 10 customers by revenue last year",
  "Bash script to back up a directory with timestamps",
  "Python script to call an API and save JSON to disk",
  "How to implement exponential backoff in axios requests",
  // Advanced dev ops / infra
  "How to scale a single-server Flask app to multiple instances",
  "How to set up blue/green deployment on Kubernetes",
  "How to write a health-check endpoint",
  "How to create a database migration strategy",
  // Interviews / mentorship
  "List of behavioral interview questions for junior devs",
  "How to give constructive feedback to a mentee",
  "Create a 30/60/90 day plan for a new hire",
  // Research / papers / citations
  "How to structure an abstract for a research paper",
  "Summarize this paper into a one-paragraph explanation",
  "How to select related work for a literature review",
  // Safety / moderation
  "How to moderate user-generated audio content safely",
  "Create a simple checklist to detect deepfake audio",
  // E-commerce / product descriptions
  "Write 6 product descriptions for a smartwatch",
  "Create 5 email subject lines for cart abandonment",
  "How to present pricing tiers clearly on a pricing page",
  // Ethics / policy
  "Explain ethical concerns of synthetic media to non-technical users",
  "How to create a responsible AI usage policy draft (high-level)",
  // Customer research / UX testing
  "Design a script for a 30-minute user interview",
  "How to analyze open-ended survey responses quickly",
  "Create a usability test plan for mobile onboarding",
  // Misc helpful personal tasks
  "How to ask a landlord for a lease extension politely",
  "How to request time off professionally from manager",
  "How to write a short resignation email",
  // Hobbies / DIY
  "Step-by-step recipe to bake a simple loaf of bread",
  "How to plan a weekend hiking trip on a budget",
  "How to start a small vegetable garden in pots",
  // Localization / translation
  "Translate this paragraph into idiomatic Spanish (friendly tone)",
  "Localize marketing copy for a Canadian audience",
  // Accessibility / inclusivity
  "Checklist for creating accessible forms (labels, errors, keyboard)",
  "How to write alt text for product images effectively",
  // Content strategy / social
  "Generate 30 Instagram captions for a fitness brand",
  "Create blog post ideas on 'AI and society' with SEO keywords",
  // Testing / QA
  "How to create a test matrix for cross-browser testing",
  "Write a reproducible test for a reported bug",
  // Data viz / reporting
  "How to choose chart types for comparing time series",
  "Create slide bullets for a 5-minute product metrics update",
  // Legal-adjacent safe prompts
  "High-level checklist for consent when recording interviews",
  "How to redact personal names from a transcript manually",
  // Career soft skills
  "How to give a short presentation when nervous",
  "How to ask for mentorship at work politely",
  // More dating / social variations
  "How to respond to 'are you seeing anyone?' tactfully",
  "What to text after a fade-away from a match",
  "How to ask if someone wants to be exclusive (text)",
  // More coding patterns
  "Explain closures in JavaScript with simple examples",
  "How to implement memoization for a slow function",
  // More ML / data ops
  "How to detect label leakage in a dataset",
  "How to run hyperparameter search effectively",
  // Even more user common asks
  "How to prepare for a coding whiteboard interview",
  "How to organize references in a research paper",
  "How to request a refund from an online order politely",
  "Tips to improve sleep hygiene for students",
  "How to write an FAQ section for a product",
  "How to build a simple habit of daily coding in 30 days",
  "How to prepare a demo for a product pitch",
  "How to write a short onboarding checklist for new users",
  "How to test for audio clipping in a recording",
  "How to identify voice overlap or unnatural cuts in audio",
  "How to measure SNR for a recorded sample",
  "How to check sample rate mismatches in audio files",
  "How to create a consent form for recording in plain language",
  "How to summarize meeting transcripts into action items",
  "How to create a quick reference guide for your app",
  "How to write friendly but firm boundaries in messages",
  "How to prepare a cheat sheet for a technical interview",
  "Write 10 subject line variations for B2B outreach",
  "Create 5 short scripts for product demo videos",
  "How to structure a simple PR/press release",
  "How to compare two versions of a resume quickly",
  "How to craft a polite 'no thanks' reply to recruiters",
  "How to ask clients for testimonials politely",
  "How to map user journeys for a new feature",
  "How to build a minimum lovable product (MLP) plan",
  "How to write a one-paragraph executive summary",
  "How to translate technical jargon into plain English",
  "How to build an accessible color palette",
  "How to write secure password reset flow",
  "How to prepare a reproducible demo for QA",
  "How to design a simple experiment for user engagement",
  "How to write a short elevator pitch for job interviews",
  "How to prepare a study plan for GRE/GMAT",
  "How to check for hallucinations in model output",
  "How to craft a media statement for incident response",
  "How to create an easy onboarding checklist for beta users",
  "How to set priorities using MoSCoW method",
  "How to structure retro notes after a sprint",
  "How to make a concise changelog entry",
  "How to write effective tooltips for complex UI",
  "How to prepare a demo script for stakeholder demo",
  "How to create a consent-friendly data collection plan",
  "How to draft a privacy-first feature rollout notice",
  "How to create a checklist for handover documentation",
  "How to set up automated backups for a small web app",
  "How to write a polite follow-up for unpaid invoices",
  "How to create a short safety script for customer support",
  "How to write a policy for acceptable use of generated content",
  "How to create a one-page onboarding for new project contributors",
  "How to summarize code review comments into tasks",
  "How to write a short checklist for content moderation",
  "How to test voice models for demographic bias (high-level)",
  "How to design a lightweight experiment for pricing",
  "How to create a simple incident response checklist",
  "How to draft a short code of conduct for community chat"
];

const PROMPT_TIPS = [
  "Include context: who is the audience, the tone, and constraints (word count, format).",
  "Specify the deliverable precisely (examples, variants, checklist, code + tests, one-paragraph summary).",
  "For social/dating: include relationship stage (first message, post-date), desired outcome (get reply, arrange meet).",
  "For code: include runtime, versions, sample input/output, expected corner-cases, and tests.",
  "For audio/forensics: include sample rate, example phrases, suspected artifacts, and how to validate.",
  "Use 'Do this / Don't do this' examples to remove ambiguity.",
  "Add success criteria: '3 variants', '<= 80 tokens', 'bullet list of steps', 'include test case'.",
  "If asking about a person or product, give short context and what to avoid (privacy/defamation).",
  "When asking for tone, give examples: 'friendly, concise, and slightly playful' or 'formal and direct'.",
  "When unsure, ask the assistant to propose 3 options and choose one to refine."
];

const PromptOptimizer = () => {
    const [input, setInput] = useState("");
    const [output, setOutput] = useState("");
    const [isOptimizing, setIsOptimizing] = useState(false);
    const [detectedRole, setDetectedRole] = useState(null);
    const [filter, setFilter] = useState("");
    const [selectedPrompt, setSelectedPrompt] = useState("");
    const [copyNotice, setCopyNotice] = useState("");

    // keyboard shortcut: Ctrl/Cmd + Enter to optimize
    useEffect(() => {
        const onKey = (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
                handleOptimize();
            }
        };
        window.addEventListener("keydown", onKey);
        return () => window.removeEventListener("keydown", onKey);
    }, [input]);

    // role detection logic
    const detectRoleAndConstraints = (text) => {
        const t = text.toLowerCase();
        let role = "World-Class Expert";
        let constraints = "- Be specific and avoid generic fluff.";
        let structure = "1) Context\n2) Steps\n3) Example\n4) Short Summary";

        if (/\b(dating|text(ing)?|ask out|flirt|crush|date|match|tinder|bumble)\b/.test(t)) {
            role = "Practical Dating & Messaging Coach";
            constraints = "- Include relationship stage and the exact goal (reply/meet/comfort).\n- Provide 3 variants: safe, casual, bold.";
            structure = "Context  3 message variants (short/medium/long)  When to send  What to avoid";
        } else if (/\b(code|javascript|python|react|node|api|sql|bug|error|function)\b/.test(t)) {
            role = "Senior Software Engineer (practical, testable)";
            constraints = "- Specify language, runtime/versions, sample input & expected output, and tests.";
            structure = "Problem  Plan  Code  Example  Tests";
        } else if (/\b(audio|voice|spectrogram|breath|sibilant|forensic|clipping)\b/.test(t)) {
            role = "Audio Forensics Specialist (practical checks)";
            constraints = "- Mention sample rate, suspected artifacts, and test phrases; include confidence guidance.";
            structure = "Context  Key signatures  How to test  Confidence / Evidence";
        } else if (/\b(image|photo|prompt engineer|dall-?e|midjourney|style)\b/.test(t)) {
            role = "Prompt Engineer for Image Generation";
            constraints = "- Include camera, lens, lighting, style, negatives, and aspect ratio.";
            structure = "Subject  Style/Lighting  Camera  Negative prompts  Params";
        } else if (/\b(job|cover letter|resume|intern|pep|co-op)\b/.test(t)) {
            role = "Career Coach (hiring-focused)";
            constraints = "- Include duration preference (e.g., 1216 months), role, and 3 achievements.";
            structure = "Opening  Relevant experience  Fit  Call to action";
        } else if (/\b(marketing|ad copy|seo|subject line|email)\b/.test(t)) {
            role = "Conversion Copywriter";
            constraints = "- Include audience, CTA, character limits, and KPI (CTR/open rate).";
            structure = "Hook  Benefit  CTA  Variants for A/B";
        }
        return { role, constraints, structure };
    };

    const handleOptimize = () => {
        if (! (input.trim() || selectedPrompt.trim()) ) return;
        setIsOptimizing(true);
        setDetectedRole(null);

        const promptText = (selectedPrompt && !input.trim()) ? selectedPrompt : input.trim();

        setTimeout(() => {
            const { role, constraints, structure } = detectRoleAndConstraints(promptText);

            // build paste-ready prompt with specifics
            const pasteReady = `${promptText}
--answer-as="${role}"
--format="variants,steps,example"
--constraints="${constraints.replace(/\n/g, ' | ')}"
--max_tokens=220
--success="Provide 3 variants (short/med/long), one concrete example, and a concise checklist of what to include/avoid."`;

            const uiOutput = `### Role: ${role}\n**Goal:** ${promptText}\n\n**Constraints & Style:**\n${constraints}\n\n**Output Structure:**\n${structure}\n\n**Paste-ready prompt (copy & paste into your LLM):**\n${pasteReady}\n\n**Quick Tips (what to include):**\n- ${PROMPT_TIPS.join("\n- ")}\n`;

            setDetectedRole(role);
            setOutput(uiOutput);
            setIsOptimizing(false);
        }, 650);
    };

    const copyToClipboard = async (text) => {
        try {
            await navigator.clipboard.writeText(text);
            setCopyNotice("Copied!");
            setTimeout(() => setCopyNotice(""), 1300);
        } catch (e) {
            alert("Copy failed  try manual copy.");
        }
    };

    const filtered = useMemo(() => {
        const q = filter.trim().toLowerCase();
        if (!q) return COMMON_PROMPTS;
        return COMMON_PROMPTS.filter(p => p.toLowerCase().includes(q) || p.toLowerCase().split(/\s+/).some(w => w.startsWith(q)));
    }, [filter]);

    return (
        <div className="space-y-6 animate-fade-in">
            <div className="grid lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2 space-y-4">
                    <div className="flex items-start justify-between gap-4">
                        <div>
                            <h2 className="text-3xl font-black text-white">Prompt Optimizer</h2>
                            <p className="text-slate-300 text-sm mt-1">Paste your ask or pick an example, then click <strong>Generate Pro Prompt</strong>. (Ctrl/Cmd+Enter to run)</p>
                        </div>

                        <div className="text-sm text-slate-400">
                            Detected persona: <div className="font-bold text-white">{detectedRole || ""}</div>
                        </div>
                    </div>

                    <div className="flex gap-3 items-center">
                        <input
                            value={filter}
                            onChange={(e) => setFilter(e.target.value)}
                            placeholder="Search examples (e.g., 'text', 'react', 'voice')"
                            className="flex-1 p-3 rounded-md bg-slate-800 border border-slate-700 text-sm placeholder-slate-500"
                        />
                        <Button onClick={() => { setFilter(""); }} variant="ghost">Clear</Button>
                    </div>

                    <textarea
                        value={input || selectedPrompt}
                        onChange={(e) => { setInput(e.target.value); setSelectedPrompt(""); }}
                        placeholder="Describe what you want (e.g., 'How to text someone after a first date? Include 3 message lengths and tone.')"
                        className="w-full min-h-[160px] p-4 rounded-2xl bg-slate-800 border border-slate-700 font-mono text-sm text-white resize-none"
                    />

                    <div className="flex gap-3">
                        <Button onClick={handleOptimize} disabled={isOptimizing || !(input.trim() || selectedPrompt.trim())} icon={Icons.Wand} variant="primary">
                            {isOptimizing ? "Optimizing..." : "Generate Pro Prompt"}
                        </Button>

                        <Button onClick={() => { setInput(""); setSelectedPrompt(""); setOutput(""); setDetectedRole(null); }} variant="ghost">Reset</Button>

                        <Button onClick={() => { if (!output) return alert("Generate first."); copyToClipboard(output); }} variant="secondary">Copy Output</Button>

                        <div className="ml-auto text-xs text-slate-400">{copyNotice}</div>
                    </div>

                    <div className="bg-slate-900 border border-slate-700 rounded-2xl p-4 min-h-[160px]">
                        {output ? (
                            <pre className="whitespace-pre-wrap font-mono text-sm text-green-400">{output}</pre>
                        ) : (
                            <div className="text-slate-500 text-sm">Your optimized prompt and persona will appear here after generation.</div>
                        )}
                    </div>

                    {/* Tips section (clear, actionable) */}
                    <div className="grid md:grid-cols-3 gap-3 mt-2">
                        <div className="bg-slate-800 p-3 rounded border border-slate-700">
                            <div className="font-bold text-white text-sm mb-2">Include</div>
                            <ul className="text-xs text-slate-300 space-y-1">
                                <li> Who is the audience (age, role, background)</li>
                                <li> Desired tone (e.g., friendly, formal, playful)</li>
                                <li> Concrete output format (examples, checklist, code + tests)</li>
                                <li> Constraints (length, tokens, language)</li>
                                <li> Success criteria (e.g., "3 variants", "get a reply")</li>
                            </ul>
                        </div>

                        <div className="bg-slate-800 p-3 rounded border border-slate-700">
                            <div className="font-bold text-white text-sm mb-2">Avoid</div>
                            <ul className="text-xs text-slate-300 space-y-1">
                                <li> Vague instructions like "be world-class" with no context</li>
                                <li> Long walls of text without examples</li>
                                <li> Asking multiple unrelated tasks in one prompt</li>
                                <li> Privacy-sensitive specifics without consent</li>
                            </ul>
                        </div>

                        <div className="bg-slate-800 p-3 rounded border border-slate-700">
                            <div className="font-bold text-white text-sm mb-2">Quick checklist</div>
                            <ul className="text-xs text-slate-300 space-y-1">
                                <li> Context </li>
                                <li> Tone </li>
                                <li> Example (do/don't) </li>
                                <li> Output shape (variants, steps) </li>
                            </ul>
                        </div>
                    </div>
                </div>

                {/* Sidebar: Examples & tips */}
                <aside className="space-y-4">
                    <Card title="Examples (click Use)" icon={Icons.List}>
                        <div style={{ maxHeight: 420, overflow: "auto" }} className="pr-2 custom-scrollbar">
                            {filtered.map((p, i) => (
                                <div key={i} className="flex items-center justify-between bg-slate-800 p-2 rounded-md border border-slate-700 my-1">
                                    <div className="text-sm text-slate-200 truncate pr-2">{p}</div>
                                    <div className="flex gap-2">
                                        <button className="text-xs px-2 py-1 rounded bg-indigo-600 hover:bg-indigo-700 font-bold" onClick={() => { setSelectedPrompt(p); setInput(""); }}>
                                            Use
                                        </button>
                                        <button className="text-xs px-2 py-1 rounded bg-slate-700 hover:bg-slate-600" onClick={() => copyToClipboard(p)}>Copy</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </Card>

                    <Card title="Prompt Tips" icon={Icons.Wand}>
                        <div className="text-xs text-slate-300 space-y-2">
                            {PROMPT_TIPS.map((t, idx) => <div key={idx}> {t}</div>)}
                            <div className="mt-2 text-[11px] text-slate-500">Pro tip: If you're stuck, paste the raw ask and use the generated persona line to force clarity (e.g., <code>--answer-as="Practical Dating Coach"</code>).</div>
                        </div>
                    </Card>

                    <Card title="Example quick flows" icon={Icons.Check}>
                        <div className="text-xs text-slate-300 space-y-2">
                            <div><strong>Texting:</strong> Provide relationship stage  3 message lengths  When to send.</div>
                            <div><strong>Code:</strong> Provide language & sample input  Ask for code + tests.</div>
                            <div><strong>Audio Forensics:</strong> Provide sample rate & suspicious segments  Ask for procedure to test.</div>
                        </div>
                    </Card>
                </aside>
            </div>
        </div>
    );
};

        const ActiveThreats = () => {
            const [index, setIndex] = useState(0);

            useEffect(() => {
                const interval = setInterval(() => {
                    setIndex((prev) => (prev + 1) % LIVE_THREATS.length);
                }, 5000);
                return () => clearInterval(interval);
            }, []);

            const currentThreat = LIVE_THREATS[index];

            return (
                <div className="bg-slate-900 border border-red-900/50 rounded-xl p-4 mb-6 flex items-center gap-4 relative overflow-hidden group">
                    <div className="absolute left-0 top-0 bottom-0 w-1 bg-red-600"></div>
                    <div className="flex-shrink-0 flex items-center gap-2 text-red-500 font-bold uppercase tracking-wider text-xs">
                        <span className="live-dot"></span>
                        Live Threats
                    </div>
                    <div className="flex-1 h-6 relative overflow-hidden">
                        <a 
                            href={currentThreat.url} 
                            target="_blank" 
                            rel="noreferrer" 
                            key={index} 
                            className="animate-[scanline_0.5s_ease-out] absolute inset-0 flex items-center text-slate-300 text-sm font-mono hover:text-red-400 transition-colors"
                        >
                            <span className="text-red-400 mr-2">[{currentThreat.type}]</span> 
                            {currentThreat.text}
                            <Icon path={Icons.ExternalLink} size={12} className="ml-2 opacity-50" />
                        </a>
                    </div>
                </div>
            );
        };

// Voice
const VoiceForensics = () => {
  // --- state (simple, human-friendly names) ---
  const [isRecording, setIsRecording] = useState(false);
  const [recordingTime, setRecordingTime] = useState(0);
  const [recordings, setRecordings] = useState([]);
  const [currentPlayback, setCurrentPlayback] = useState(null);
  const [audioLevels, setAudioLevels] = useState(new Array(20).fill(10));
  const [analyzingId, setAnalyzingId] = useState(null);
  const [showGuide, setShowGuide] = useState(false);
  const [practiceMode, setPracticeMode] = useState(false);
  // user guesses: { recId: { zeroBreath: bool, shimmer: bool, pitchStable: bool, latency: bool } }
  const [userGuesses, setUserGuesses] = useState({});

  // --- refs for media / visualizer / audio elements ---
  const mediaRecorderRef = useRef(null);
  const audioContextRef = useRef(null);
  const analyserRef = useRef(null);
  const timerRef = useRef(null);
  const chunksRef = useRef([]);
  const animationFrameRef = useRef(null);
  const audioElementsRef = useRef({});

  // Clean up on unmount: stop any running audio, cancel frames, close audioContext, revoke URLs
  useEffect(() => {
    return () => {
      cancelAnimationFrame(animationFrameRef.current);
      clearInterval(timerRef.current);
      if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {
        try { mediaRecorderRef.current.stop(); } catch (e) {}
      }
      if (audioContextRef.current) {
        try { audioContextRef.current.close(); } catch (e) {}
      }
      // revoke object URLs we created
      recordings.forEach(r => {
        if (r.url && r.url.startsWith('blob:')) {
          try { URL.revokeObjectURL(r.url); } catch (e) {}
        }
      });
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // Helper: clamp and smooth values for visualizer
  const smoothLevels = (rawArr) => {
    // simple smoothing: clamp and scale to 6-100%
    return rawArr.slice(0, 20).map(v => {
      const scaled = Math.floor((v / 255) * 100);
      return Math.max(6, Math.min(100, scaled));
    });
  };

  // Start recording: request mic, wire analyser for visual feedback, start mediaRecorder
  const startRecording = async () => {
    try {
      // If an existing audioContext exists, close it first to avoid multiple contexts
      if (audioContextRef.current) {
        try { await audioContextRef.current.close(); } catch (e) {}
        audioContextRef.current = null;
      }

      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
      analyserRef.current = audioContextRef.current.createAnalyser();
      analyserRef.current.fftSize = 64; // compact visualizer
      const source = audioContextRef.current.createMediaStreamSource(stream);
      source.connect(analyserRef.current);

      // Setup MediaRecorder
      mediaRecorderRef.current = new MediaRecorder(stream);
      chunksRef.current = [];

      mediaRecorderRef.current.ondataavailable = (e) => {
        if (e.data && e.data.size > 0) chunksRef.current.push(e.data);
      };

      mediaRecorderRef.current.onstop = async () => {
        try {
          const blob = new Blob(chunksRef.current, { type: 'audio/webm' });
          const url = URL.createObjectURL(blob);

          // create a placeholder recording; we'll update duration shortly if we can
          const id = Date.now();
          const placeholder = {
            id,
            url,
            date: new Date().toLocaleString(),
            duration: recordingTime, // best-effort
            name: `Audio Evidence ${recordings.length + 1}`,
            analysis: null
          };

          // add immediately so UI updates, then try to read accurate duration
          setRecordings(prev => [placeholder, ...prev]);
          setRecordingTime(0);

          // stop microphone tracks
          stream.getTracks().forEach(track => {
            try { track.stop(); } catch (e) {}
          });

          // compute accurate duration if possible (load metadata)
          const probe = new Audio();
          probe.src = url;
          probe.onloadedmetadata = () => {
            const accurate = Math.round(probe.duration);
            setRecordings(prev => prev.map(r => r.id === id ? { ...r, duration: accurate } : r));
            probe.src = '';
          };
        } catch (err) {
          console.error('Error finalizing recording', err);
        } finally {
          cancelAnimationFrame(animationFrameRef.current);
          setAudioLevels(new Array(20).fill(10));
        }
      };

      mediaRecorderRef.current.start();
      setIsRecording(true);

      // timer increment for UI time display
      timerRef.current = setInterval(() => setRecordingTime(prev => prev + 1), 1000);

      // visualizer loop
      const updateVisualizer = () => {
        if (!analyserRef.current) return;
        const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);
        analyserRef.current.getByteFrequencyData(dataArray);
        const newLevels = smoothLevels(Array.from(dataArray));
        setAudioLevels(newLevels);
        animationFrameRef.current = requestAnimationFrame(updateVisualizer);
      };
      updateVisualizer();
    } catch (err) {
      console.error("mic error", err);
      alert("Could not access mic. Check microphone permissions and try again.");
    }
  };

  // Stop the recorder safely
  const stopRecording = () => {
    if (mediaRecorderRef.current && isRecording) {
      try {
        mediaRecorderRef.current.stop();
      } catch (e) {
        // ignore - sometimes it throws if already stopping
      }
      setIsRecording(false);
      clearInterval(timerRef.current);
    }
  };

  // Toggle playback for a recording: pause current, play requested. Safe checks everywhere.
  const togglePlayback = (recording) => {
    try {
      // if clicking on currently playing, pause it
      if (currentPlayback === recording.id) {
        const audio = audioElementsRef.current[recording.id];
        if (audio) {
          audio.pause();
          audio.currentTime = 0;
        }
        setCurrentPlayback(null);
        return;
      }

      // pause any other playing audio
      if (currentPlayback && audioElementsRef.current[currentPlayback]) {
        const prev = audioElementsRef.current[currentPlayback];
        try { prev.pause(); prev.currentTime = 0; } catch (e) {}
      }

      // create the audio element if not present
      if (!audioElementsRef.current[recording.id]) {
        const audio = new Audio(recording.url);
        audio.onended = () => setCurrentPlayback(null);
        audioElementsRef.current[recording.id] = audio;
      }

      const toPlay = audioElementsRef.current[recording.id];
      // try to play (browsers may block autoplay if not triggered by user)
      const playPromise = toPlay.play();
      if (playPromise && playPromise.catch) {
        playPromise.catch(err => {
          console.warn('Playback prevented:', err);
          alert('Playback blocked by browser. Try interacting (click) before playing.');
        });
      }
      setCurrentPlayback(recording.id);
    } catch (err) {
      console.error('Playback error', err);
      alert('Playback error  check console for details.');
    }
  };

  // Simple helper for artifact label text
  const artifactLabel = (key) => {
    if (key === 'zeroBreath') return 'Zero-breath';
    if (key === 'shimmer') return 'Metallic shimmer';
    if (key === 'pitchStable') return 'Pitch stability';
    if (key === 'latency') return 'Latency / buffer';
    return key;
  };

  // Simulated analysis (lightweight). This fills rec.analysis with score, label, details, artifacts.
  // In a real app you'd call a backend model. Here we keep behavior deterministic-ish by seeding from id.
  const analyzeRecording = (id) => {
    setAnalyzingId(id);
    // small simulated delay to mimic network / processing
    setTimeout(() => {
      setRecordings(prev => prev.map(rec => {
        if (rec.id !== id) return rec;

        // pseudo-random but seeded from id to get reproducible-ish results in session
        const seed = (id % 1000) / 1000;
        const isFake = seed > 0.45; // about half the time
        const score = isFake ? Math.floor(70 + (seed * 30)) : Math.floor(seed * 45);
        const label = isFake ? "Synthetic Signature Detected" : "Natural Voice Patterns";
        const details = isFake
          ? "Zero-breath artifact; faint metallic shimmer on sibilants. Pitch looks unusually steady in places."
          : "Natural breathing and pitch variation detected; subtle room tone present.";
        const artifacts = {
          zeroBreath: isFake,
          shimmer: isFake && (seed > 0.6),
          pitchStable: isFake && (seed > 0.55),
          latency: Math.random() > 0.8 // latency is more random
        };

        return { ...rec, analysis: { score, label, details, artifacts } };
      }));
      setAnalyzingId(null);
    }, 1100);
  };

  // Delete safely: pause audio if playing, remove from arrays, revoke URL
  const deleteRecording = (id) => {
    try {
      if (currentPlayback === id && audioElementsRef.current[id]) {
        try {
          audioElementsRef.current[id].pause();
        } catch (e) {}
        setCurrentPlayback(null);
      }
      setRecordings(prev => prev.filter(r => r.id !== id));
      // revoke object URL if blob
      if (audioElementsRef.current[id]) {
        try { audioElementsRef.current[id].src = ''; } catch (e) {}
        delete audioElementsRef.current[id];
      }
      // attempt to revoke URL in case it's a blob we created
      // find by id in recordings (we just removed it so check previous data)
      // (best-effort; if you stored URL earlier, it will be revoked here)
      // NOTE: we can't access removed recording easily now; browsers will free it eventually.
    } catch (err) {
      console.error('Error deleting recording', err);
    }
  };

  // Upload file handler: create object URL and add to recordings list
  const handleFileUpload = (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    const id = Date.now();
    const newRecording = {
      id,
      url,
      date: new Date().toLocaleString(),
      duration: 0, // we'll attempt to read duration
      name: file.name,
      analysis: null
    };
    setRecordings(prev => [newRecording, ...prev]);

    // try to read accurate duration
    const audio = new Audio();
    audio.src = url;
    audio.onloadedmetadata = () => {
      const d = Math.round(audio.duration || 0);
      setRecordings(prev => prev.map(r => r.id === id ? { ...r, duration: d } : r));
      audio.src = '';
    };
  };

  // Toggle user's guess for a recording artifact
  const toggleGuess = (recId, key) => {
    setUserGuesses(prev => {
      const recGuesses = prev[recId] || {};
      return { ...prev, [recId]: { ...recGuesses, [key]: !recGuesses[key] } };
    });
  };

  // Reveal analysis vs user guesses  friendly detailed feedback
  const revealAnalysis = (rec) => {
    if (!rec.analysis) {
      alert("Run 'Analyze' first to get the ground truth analysis.");
      return;
    }
    const guesses = userGuesses[rec.id] || {};
    const actual = rec.analysis.artifacts || {};
    const keys = Object.keys({ ...actual, ...guesses });
    const results = keys.map(k => {
      const user = !!guesses[k];
      const truth = !!actual[k];
      return { key: k, user, truth, correct: user === truth };
    });

    const correctCount = results.filter(r => r.correct).length;
    // build a human-friendly multiline message
    let msg = `Results for "${rec.name}"  ${correctCount}/${results.length} correct\n\n`;
    results.forEach(r => {
      msg += `${artifactLabel(r.key)}: your guess=${r.user ? 'Yes' : 'No'} | actual=${r.truth ? 'Yes' : 'No'}  ${r.correct ? '' : ''}\n`;
      if (!r.correct) {
        // short actionable tip for common artifacts
        if (r.key === 'zeroBreath') msg += '  Tip: listen for short low-frequency inhales before phrases.\n';
        if (r.key === 'shimmer') msg += '  Tip: slow to 0.75 and solo sibilants  metallic shimmer will pop.\n';
        if (r.key === 'pitchStable') msg += '  Tip: listen for micro-tremors during emotional words  AI often lacks them.\n';
        if (r.key === 'latency') msg += '  Tip: interrupt or ask a quick unexpected question  converted audio may glitch.\n';
      }
    });

    // show analysis summary at the end
    msg += `\nSystem analysis: ${rec.analysis.label} (${rec.analysis.score}%)\n${rec.analysis.details}`;

    // show to user
    alert(msg);
  };

  // --- Render UI (kept your original layout but with small safety tweaks) ---
  return (
    <div className="grid lg:grid-cols-2 gap-8 animate-fade-in h-[calc(100vh-140px)]">
      {/* Recorder */}
      <div className="flex flex-col h-full bg-slate-800 rounded-3xl shadow-lg border border-slate-700 overflow-hidden relative">
        <div className={`absolute inset-0 transition-opacity duration-500 pointer-events-none ${isRecording ? 'opacity-20 bg-red-500' : 'opacity-0'}`}></div>
        <div className="flex-1 flex flex-col items-center justify-center p-8 relative z-10">
          <div className="absolute top-6 right-6">
            <Button variant="secondary" className="text-xs" icon={Icons.Book} onClick={() => setShowGuide(true)}>Audio Signatures Guide</Button>
          </div>

          <div className="text-6xl font-mono text-slate-200 font-bold mb-8 tracking-wider">{formatTime(recordingTime)}</div>

          {/* Visualizer */}
          <div className="flex items-end justify-center gap-1 h-24 w-full max-w-sm mb-12" aria-hidden>
            {audioLevels.map((level, idx) => (
              <div
                key={idx}
                className={`w-3 rounded-t-full transition-all duration-75 ${isRecording ? 'bg-red-500' : 'bg-slate-600'}`}
                style={{ height: `${level}%` }}
                role="presentation"
              />
            ))}
          </div>

          <div className="relative">
            {isRecording && <div className="pulse-ring" aria-hidden></div>}
            <button
              onClick={isRecording ? stopRecording : startRecording}
              className={`w-24 h-24 rounded-full flex items-center justify-center shadow-xl transition-all transform hover:scale-105 active:scale-95 focus:outline-none z-20 ${isRecording ? 'bg-white border-4 border-red-500 text-red-500' : 'bg-red-500 text-white border-4 border-red-100/10'}`}
              aria-pressed={isRecording}
              aria-label={isRecording ? 'Stop recording' : 'Start recording'}
            >
              <Icon path={isRecording ? Icons.Square : Icons.Mic} size={40} />
            </button>
          </div>

          <p className="mt-8 text-slate-400 font-medium tracking-wide uppercase text-sm">{isRecording ? "Listening..." : "Tap to Record Evidence"}</p>

          <div className="mt-8">
            <label className="cursor-pointer text-indigo-500 hover:text-indigo-400 font-bold text-sm flex items-center gap-2">
              <input type="file" accept="audio/*" onChange={handleFileUpload} className="hidden" />
              <Icon path={Icons.Upload} size={16} /> Upload Audio File
            </label>

            {/* Practice toggle (small help text for learners) */}
            <label className="flex items-start gap-3 p-3 rounded-lg bg-slate-900 border border-slate-700 mt-3">
              <input
                type="checkbox"
                checked={practiceMode}
                onChange={() => setPracticeMode(prev => !prev)}
                className="w-4 h-4 mt-1"
              />
              <div>
                <div className="font-bold text-sm text-slate-100">Practice Mode  Guess artifacts</div>
                <div className="text-xs text-slate-400 mt-1">
                  Turn this on to test yourself: mark the checkboxes on each recording while you listen, then press "Analyze" and "Reveal Comparison".
                </div>
              </div>
            </label>
          </div>
        </div>
      </div>

      {/* List Section */}
      <div className="flex flex-col h-full space-y-4">
        <div className="flex items-center justify-between">
          <h3 className="text-xl font-bold text-white flex items-center gap-2"><Icon path={Icons.List} /> Evidence Locker</h3>
          <span className="text-sm font-bold text-slate-400">{recordings.length} Files</span>
        </div>

        <div className="flex-1 overflow-y-auto space-y-3 pr-2 custom-scrollbar">
          {recordings.length === 0 ? (
            <div className="h-64 flex flex-col items-center justify-center text-slate-400 gap-3 border-2 border-dashed border-slate-700 rounded-2xl">
              <Icon path={Icons.MicOff} size={48} className="opacity-50" />
              <span>No audio evidence collected yet.</span>
            </div>
          ) : (
            recordings.map(rec => (
              <div key={rec.id} className="bg-slate-800 border border-slate-700 p-4 rounded-2xl shadow-sm hover:shadow-md transition-all">
                <div className="flex items-center gap-4 mb-3">
                  <button
                    onClick={() => togglePlayback(rec)}
                    className={`w-12 h-12 rounded-full flex items-center justify-center ${currentPlayback === rec.id ? 'bg-indigo-600 text-white' : 'bg-slate-700 text-slate-300'}`}
                    aria-label={currentPlayback === rec.id ? 'Pause' : 'Play'}
                  >
                    <Icon path={currentPlayback === rec.id ? Icons.Pause : Icons.Play} size={20} />
                  </button>

                  <div className="flex-1 min-w-0">
                    <div className="font-bold text-slate-200 truncate">{rec.name}</div>
                    <div className="text-xs text-slate-400 flex items-center gap-2 mt-1">
                      <span>{rec.date}</span>
                      {rec.duration > 0 && <span> {formatTime(rec.duration)}</span>}
                    </div>
                  </div>

                  <div className="flex gap-2 items-center">
                    <Button
                      variant="secondary"
                      className="!px-3 !py-2 !rounded-lg"
                      onClick={() => analyzeRecording(rec.id)}
                      disabled={!!rec.analysis || analyzingId === rec.id}
                      aria-disabled={!!rec.analysis || analyzingId === rec.id}
                    >
                      {analyzingId === rec.id ? <div className="animate-spin w-4 h-4 border-2 border-indigo-600 border-t-transparent rounded-full" /> : <Icon path={Icons.Activity} size={16} />}
                    </Button>

                    <button onClick={() => deleteRecording(rec.id)} className="p-2 text-slate-300 hover:text-red-500 hover:bg-red-900/20 rounded-lg transition-colors" aria-label="Delete recording">
                      <Icon path={Icons.Trash2} size={18} />
                    </button>
                  </div>
                </div>

                {/* user practice checkboxes */}
                <div className="grid grid-cols-3 gap-2 text-xs text-slate-300 mb-3">
                  {["zeroBreath", "shimmer", "pitchStable"].map(key => (
                    <label key={key} className={`flex items-start gap-2 p-2 rounded bg-slate-900 border border-slate-700 ${practiceMode ? '' : 'opacity-70'}`}>
                      <input
                        type="checkbox"
                        checked={!!(userGuesses[rec.id] && userGuesses[rec.id][key])}
                        onChange={() => toggleGuess(rec.id, key)}
                        disabled={!practiceMode}
                        aria-checked={!!(userGuesses[rec.id] && userGuesses[rec.id][key])}
                      />
                      <div>
                        <div className="font-bold text-xs">
                          {key === "zeroBreath" ? "Zero-breath" : key === "shimmer" ? "Metallic shimmer" : "Pitch stability"}
                        </div>
                        <div className="text-[11px] text-slate-400">{key === "zeroBreath" ? "Long continuous speech w/o inhalation" : key === "shimmer" ? "Sibilant metallic buzz" : "Unnaturally steady pitch"}</div>
                      </div>
                    </label>
                  ))}
                </div>

                {/* Analysis Result */}
                {rec.analysis && (
                  <div className={`mt-3 p-3 rounded-xl border text-sm ${rec.analysis.score > 50 ? 'bg-red-900/10 border-red-900/30' : 'bg-green-900/10 border-green-900/30'}`}>
                    <div className="flex justify-between items-center mb-1">
                      <span className={`font-bold ${rec.analysis.score > 50 ? 'text-red-400' : 'text-green-400'}`}>{rec.analysis.label} ({rec.analysis.score}%)</span>
                      <div className="flex items-center gap-3">
                        <button className="text-xs text-indigo-400" onClick={() => revealAnalysis(rec)}>Reveal Comparison</button>
                      </div>
                    </div>
                    <p className="text-slate-400 text-xs">{rec.analysis.details}</p>
                  </div>
                )}
              </div>
            ))
          )}
        </div>
      </div>

      {/* Audio Signatures Guide Modal */}
      <Modal isOpen={showGuide} onClose={() => setShowGuide(false)} title="Audio Signatures Guide">
        <div className="space-y-4">
          <div className="grid gap-3">
            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
              <h4 className="font-bold text-white mb-2 flex items-center gap-2"><Icon path={Icons.Mic} size={16} /> Zero-Breath Artifact</h4>
              <p className="text-sm text-slate-400">Human speakers inhale roughly every 48 seconds. AI speech often produces long continuous phrases with near-zero inhalation sounds. Practice: play short clips and try to detect a breath before the next phrase.</p>
            </div>
            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
              <h4 className="font-bold text-white mb-2 flex items-center gap-2"><Icon path={Icons.Zap} size={16} /> Metallic Shimmer</h4>
              <p className="text-sm text-slate-400">Listen for unnatural high-frequency buzzing on sibilants (S/F/T). Vocoder/codec artifacts often appear there. Tip: slow the segment to 0.75 and listen closely to "s" sounds.</p>
            </div>
            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
              <h4 className="font-bold text-white mb-2 flex items-center gap-2"><Icon path={Icons.Activity} size={16} /> Perfect Pitch Stability</h4>
              <p className="text-sm text-slate-400">AI voices often have micro-tremors missing  pitch looks unnaturally steady. Natural emotion introduces micro-variations. Tip: compare an emotional word vs a neutral word.</p>
            </div>
            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
              <h4 className="font-bold text-white mb-2 flex items-center gap-2"><Icon path={Icons.Target} size={16} /> Latency / Buffering Artifacts</h4>
              <p className="text-sm text-slate-400">Real-time voice conversion can introduce small delays. Practice: ask a fast follow-up question  converted audio may glitch or slightly overlap.</p>
            </div>
            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
              <h4 className="font-bold text-white mb-2 flex items-center gap-2"><Icon path={Icons.Shield} size={16} /> Practice Tip</h4>
              <p className="text-sm text-slate-400">Use short tests: ask a rapid math question, interrupt mid-sentence, or ask something personal/unexpected to prompt natural breathing & emotion. Enable Practice Mode and compare your guesses to the system's analysis.</p>
            </div>
          </div>
        </div>
      </Modal>
    </div>
  );
};

        // --- IMAGE INSPECTOR 3.0 (ORIGINAL IMPLEMENTATION RESTORED) ---
        const VisualForensics = () => {
            const [mode, setMode] = useState('compare');
            const [uploadedImage, setUploadedImage] = useState(null);
            const [checklist, setChecklist] = useState({
                fingers: false, eyes: false, text: false, texture: false, physics: false
            });
            const [showHeatmap, setShowHeatmap] = useState(false);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => setUploadedImage(e.target.result);
                    reader.readAsDataURL(file);
                }
            };

            const risk = useMemo(() => {
                const count = Object.values(checklist).filter(Boolean).length;
                if (count >= 4) return { level: "CRITICAL", color: "red", score: 95 };
                if (count >= 2) return { level: "SUSPICIOUS", color: "orange", score: 60 };
                return { level: "LIKELY SAFE", color: "green", score: 10 };
            }, [checklist]);

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                        <div>
                            <h2 className="text-3xl font-black text-white">Visual Forensics Lab</h2>
                            <p className="text-slate-400 mt-1">Analyze imagery for synthetic artifacts using side-by-side comparison or direct upload.</p>
                        </div>
                        <div className="flex bg-slate-800 p-1 rounded-xl">
                            <button onClick={() => setMode('compare')} className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${mode === 'compare' ? 'bg-slate-700 shadow-sm text-white' : 'text-slate-500'}`}>Gallery</button>
                            <button onClick={() => setMode('upload')} className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${mode === 'upload' ? 'bg-slate-700 shadow-sm text-white' : 'text-slate-500'}`}>Inspector Tool</button>
                        </div>
                    </div>

                    {mode === 'compare' && (
                        <div className="grid lg:grid-cols-2 gap-8">
                            {COMPARISON_GALLERY.map((item) => (
                                <Card key={item.id} className="overflow-hidden">
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="relative group rounded-xl overflow-hidden cursor-crosshair">
                                            <div className="absolute top-2 left-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded shadow-lg z-10">AUTHENTIC</div>
                                            <img src={item.realUrl} alt="Real" className="w-full h-48 object-cover" />
                                        </div>
                                        <div className="relative group rounded-xl overflow-hidden cursor-crosshair">
                                            <div className="absolute top-2 left-2 bg-purple-500 text-white text-xs font-bold px-2 py-1 rounded shadow-lg z-10">AI SIMULATION</div>
                                            <img 
                                                src={item.realUrl} 
                                                alt="AI Sim" 
                                                className={`w-full h-48 object-cover ${item.aiType === 'smooth' ? 'blur-[1px] contrast-125 brightness-110' : item.aiType === 'warped' ? 'scale-110 rotate-1 blur-[2px]' : 'grayscale-[50%] contrast-150'}`} 
                                                style={{ filter: item.aiType === 'smooth' ? 'saturate(1.5) blur(0.5px)' : '' }}
                                            />
                                            {item.aiType === 'glitch' && (
                                                <div className="absolute inset-0 pointer-events-none opacity-50 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]"></div>
                                            )}
                                            {item.aiType === 'text_fail' && (
                                                <div className="absolute inset-0 flex items-center justify-center opacity-70">
                                                    <span className="text-white font-serif text-4xl rotate-12 blur-sm"></span>
                                                </div>
                                            )}
                                            <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center text-white p-4 text-center">
                                                <p className="font-bold text-sm mb-2">Forensic Analysis</p>
                                                <p className="text-xs">{item.description}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="mt-4 pt-4 border-t border-slate-700">
                                        <h3 className="font-bold text-lg text-slate-100">{item.title}</h3>
                                        <p className="text-sm text-slate-400 mt-1">Hover over the AI image to reveal forensic analysis notes.</p>
                                    </div>
                                </Card>
                            ))}
                        </div>
                    )}

                    {mode === 'upload' && (
                        <div className="grid lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2">
                                <div className="border-2 border-dashed border-slate-600 rounded-2xl h-[500px] flex flex-col items-center justify-center bg-slate-800/50 relative overflow-hidden group">
                                    {uploadedImage ? (
                                        <>
                                            <img src={uploadedImage} alt="Analysis Target" className="max-w-full max-h-full object-contain relative z-10" />
                                            {showHeatmap && <div className="absolute inset-0 z-20 mix-blend-overlay bg-gradient-to-tr from-red-500/50 via-transparent to-blue-500/50 pointer-events-none animate-pulse"></div>}
                                            <div className="absolute inset-0 bg-gradient-to-b from-transparent via-green-500/20 to-transparent h-1 w-full animate-[scanline_2s_linear_infinite] pointer-events-none z-30"></div>
                                            <div className="absolute top-4 right-4 z-40 flex gap-2">
                                                 <Button variant="secondary" onClick={() => setShowHeatmap(!showHeatmap)} icon={Icons.Eye}>
                                                    {showHeatmap ? "Hide Heatmap" : "Show ELA Simulation"}
                                                 </Button>
                                                <Button variant="danger" onClick={() => setUploadedImage(null)} icon={Icons.X}>Clear</Button>
                                            </div>
                                        </>
                                    ) : (
                                        <div className="text-center p-8">
                                            <div className="w-20 h-20 bg-indigo-900/30 rounded-full flex items-center justify-center mx-auto mb-6 text-indigo-400">
                                                <Icon path={Icons.Upload} size={40} />
                                            </div>
                                            <h3 className="text-xl font-bold mb-2 text-white">Upload Image for Inspection</h3>
                                            <p className="text-slate-400 mb-6 max-w-sm mx-auto">
                                                Supports JPG, PNG, WEBP. Images are processed locally in your browser for privacy.
                                            </p>
                                            <label className="cursor-pointer">
                                                <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} />
                                                <span className="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-lg hover:shadow-indigo-500/30">
                                                    Select File
                                                </span>
                                            </label>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="lg:col-span-1 space-y-6">
                                <Card title="Forensic Checklist" icon={Icons.Target}>
                                    <div className="space-y-4">
                                        {[
                                            { id: 'fingers', label: 'Distorted Hands', desc: 'Count fingers. Look for melding.' },
                                            { id: 'eyes', label: 'Asymmetrical Eyes', desc: 'Check pupil shape and reflection.' },
                                            { id: 'text', label: 'Gibberish Text', desc: 'Alien symbols in background.' },
                                            { id: 'texture', label: 'Plastic Skin', desc: 'Lack of pores/imperfections.' },
                                            { id: 'physics', label: 'Physics Violations', desc: 'Impossible shadows/gravity.' }
                                        ].map(item => (
                                            <label key={item.id} className={`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-all ${checklist[item.id] ? 'bg-red-900/20 border-red-800' : 'bg-slate-800 border-slate-700'}`}>
                                                <div className="pt-0.5">
                                                    <input 
                                                        type="checkbox" 
                                                        className="w-5 h-5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"
                                                        checked={checklist[item.id]}
                                                        onChange={() => setChecklist(prev => ({...prev, [item.id]: !prev[item.id]}))}
                                                    />
                                                </div>
                                                <div>
                                                    <span className={`font-bold text-sm block ${checklist[item.id] ? 'text-red-300' : 'text-slate-200'}`}>{item.label}</span>
                                                    <span className="text-xs text-slate-400">{item.desc}</span>
                                                </div>
                                            </label>
                                        ))}
                                    </div>
                                </Card>
                                {uploadedImage && (
                                    <Card className={`text-center border-t-4 ${risk.score > 50 ? 'border-t-red-500' : 'border-t-green-500'}`}>
                                        <div className="text-xs font-bold uppercase tracking-widest text-slate-400 mb-2">Analysis Result</div>
                                        <div className={`text-4xl font-black mb-2 ${risk.score > 50 ? 'text-red-600' : 'text-green-600'}`}>{risk.level}</div>
                                        <p className="text-sm text-slate-500">Based on manual forensic inspection.</p>
                                    </Card>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

   //TEXT
const TextForensics = () => {
  // core text state
  const [text, setText] = useState("");
  const [result, setResult] = useState(null);
  const [isScanning, setIsScanning] = useState(false);
  const [showCompare, setShowCompare] = useState(false);

  // practice state & user guesses
const [textPractice, setTextPractice] = useState(true); // Enabled by default
  const [textChecklist, setTextChecklist] = useState({
    repetitive: false, connectors: false, grammar: false, generic: false, 
    emotion: false, hedging: false, formatting: false
  });
  const [userWordGuesses, setUserWordGuesses] = useState({});
  const [userSentenceGuesses, setUserSentenceGuesses] = useState({});

  // reveal modal state (instead of alert)
  const [showRevealModal, setShowRevealModal] = useState(false);
  const [revealData, setRevealData] = useState(null);

  // small helper lists
  const STOPWORDS = new Set([
    'the','is','in','and','to','a','of','it','that','this','for','on','with','as','are','was','be','by','an','or','from'
  ]);
  const CONNECTORS = ['furthermore','in conclusion','moreover','therefore','consequently','in summary','ultimately','overall'];

  // helpers to split tokens & sentences (keeps whitespace)
  const wordsWithIndexes = (content) => content.split(/(\s+)/).map((tok,i)=>({text:tok,idx:i}));
  const sentences = (content) => {
    // robust sentence split preserving punctuation
    const raw = content.split(/([.!?]+)\s*/).reduce((acc, cur) => {
      if (cur === '' || cur == null) return acc;
      if (/[.!?]+/.test(cur) && acc.length) {
        acc[acc.length-1] += cur;
      } else {
        acc.push(cur);
      }
      return acc;
    }, []);
    return raw.filter(Boolean).map((t,i)=>({text:t.trim(), idx:i}));
  };

  // small lexical helpers
  const isContraction = (w) => /'\w|n't|\w/i.test(w);
  const cleanToken = (t) => (t || '').toLowerCase().replace(/[^\w]/g,'');

  // HighlightedText: highlights AI tokens, repeated words, long/rare words, and user selections
  const HighlightedText = ({ content, analysis }) => {
    const tokens = wordsWithIndexes(content);
    const aiSet = new Set((analysis && analysis.aiWords) ? analysis.aiWords.map(w=>w.toLowerCase()) : []);
    const repeated = new Set((analysis && analysis.repeatedWords) ? analysis.repeatedWords : []);
    const rare = new Set((analysis && analysis.rareWords) ? analysis.rareWords : []);
    return (
      <div className="whitespace-pre-wrap leading-relaxed text-slate-200">
        {tokens.map(tok => {
          const raw = tok.text;
          const clean = cleanToken(raw);
          const isAi = aiSet.has(clean) && clean.length>0;
          const isRep = repeated.has(clean);
          const isRare = rare.has(clean);
          const marked = !!userWordGuesses[tok.idx];
          const interactive = textPractice && raw.trim().length>0;

          const cls = [
            isAi ? 'bg-indigo-900/40 text-indigo-300' : '',
            isRep ? 'bg-yellow-900/30 text-yellow-300' : '',
            isRare ? 'underline decoration-dotted' : '',
            marked ? 'outline outline-2 outline-yellow-400/40 rounded-sm' : '',
            interactive ? 'cursor-pointer hover:brightness-105' : ''
          ].join(' ');

          const tooltip = isAi ? `AI-style token: ${clean}` : (isRep ? 'Repeated term' : (isRare ? 'Long/rare word' : (interactive ? 'Click to mark suspect' : '')));

          return (
            <span
              key={tok.idx}
              onClick={() => {
                if (!interactive) return;
                setUserWordGuesses(prev => ({ ...prev, [tok.idx]: !prev[tok.idx] }));
              }}
              title={tooltip}
              className={cls}
              style={{ whiteSpace: 'pre-wrap' }}
            >
              {raw}
            </span>
          );
        })}
      </div>
    );
  };

  // Analyze: many heuristics collected into result
  const analyze = () => {
    if (text.length < 50) return;
    setIsScanning(true);
    setResult(null);

    setTimeout(() => {
      const cleanWords = (text.toLowerCase().match(/\b(\w+)\b/g) || []);
      const sents = sentences(text);
      const sentenceWordCounts = sents.map(s => (s.text.match(/\b(\w+)\b/g) || []).length);
      const avgLen = sentenceWordCounts.length ? (sentenceWordCounts.reduce((a,b)=>a+b,0)/sentenceWordCounts.length) : 0;
      const variance = sentenceWordCounts.length ? (sentenceWordCounts.reduce((a,b)=>a + Math.pow(b - avgLen,2),0)/sentenceWordCounts.length) : 0;
      const burstiness = Math.sqrt(variance);

      // lexical stats
      const totalWords = cleanWords.length;
      const uniqueWords = new Set(cleanWords).size;
      const typeTokenRatio = totalWords ? +(uniqueWords/totalWords).toFixed(3) : 0;
      const avgWordLen = totalWords ? +(cleanWords.reduce((a,b)=>a+b.length,0)/totalWords).toFixed(2) : 0;
      const contractionCount = (text.match(/n't|'ve|'re|'ll|'d|'s|t|ve|re|ll|d|s/gi) || []).length;

      // punctuation complexity
      const commas = (text.match(/,/g) || []).length;
      const semicolons = (text.match(/;/g) || []).length;
      const quotes = (text.match(/["']/g) || []).length;
      const parens = (text.match(/[()]/g) || []).length;
      const punctuationComplexity = commas + semicolons + quotes + parens;

      // buzzword detection using AI_VOCABULARY (assume exists)
      let buzzCount = 0, aiWordsFound = [];
      Object.values(AI_VOCABULARY).forEach(cat => {
        cat.words.forEach(w => {
          const hits = cleanWords.filter(x=>x===w).length;
          if (hits>0) {
            buzzCount += hits;
            aiWordsFound.push(w);
          }
        });
      });

      // repetition: words occurring more than once (excluding stopwords)
      const freq = {};
      cleanWords.forEach(w => { if (!STOPWORDS.has(w)) freq[w] = (freq[w]||0)+1; });
      const repeatedWords = Object.entries(freq).filter(([w,c]) => c>1).map(([w])=>w);
      // rare words = long words length>8 (heuristic)
      const rareWords = Array.from(new Set(cleanWords.filter(w=>w.length>8)));

      // connectors
      const connectorHits = cleanWords.filter(w => CONNECTORS.includes(w)).length;

      // top words
      const topWords = Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,8).map(([w,c])=>({w,c}));

      // sentence flagging: increased heuristics
      const flaggedSentences = sents.map((s, idx) => {
        const wds = (s.text.toLowerCase().match(/\b(\w+)\b/g)||[]);
        const rareCount = wds.filter(w => w.length>8).length;
        const buzzHits = wds.filter(w => aiWordsFound.includes(w)).length;
        const contr = wds.filter(w => isContraction(w)).length;
        const stopRatio = wds.length ? (wds.filter(w=>STOPWORDS.has(w)).length / wds.length) : 0;
        // score: buzz & rare increase suspicion, high stopRatio reduces it slightly (more natural)
        const score = buzzHits*2 + rareCount*1.5 + (wds.length>0 && wds.length<8 ? 0.6 : 0) - (contr*0.6) - (stopRatio*0.5);
        return { idx, text: s.text, score: +(score.toFixed(2)), buzzHits, rareCount, contr };
      }).filter(s=>s.score>1); // only keep suspicious

      // build aiScore combining signals
      let aiScore = 0;
      if (burstiness < 6) aiScore += 28;
      aiScore += Math.min(30, buzzCount * 6);
      if (typeTokenRatio > 0.6) aiScore += 8; // high TTR can indicate repetitive but also polished text
      if (connectorHits > 0) aiScore += 10;
      if (contractionCount < Math.max(1, Math.floor(totalWords / 80))) aiScore += 6; // lack of contractions => more likely machine
      if (punctuationComplexity > Math.max(3, sents.length)) aiScore += 6;
      if (repeatedWords.length > 2) aiScore += 6;

      aiScore = Math.min(99, Math.round(aiScore));

      setResult({
        score: aiScore,
        burstiness: +(burstiness.toFixed(2)),
        avgLen: +(avgLen.toFixed(1)),
        buzzCount,
        aiWords: Array.from(new Set(aiWordsFound)),
        repeatedWords,
        rareWords,
        typeTokenRatio,
        contractionCount,
        punctuationComplexity,
        topWords,
        flaggedSentences
      });

      // reset user selections for a fresh practice round but keep practice mode flag
      setUserWordGuesses({});
      setUserSentenceGuesses({});
      setIsScanning(false);
    }, 900);
  };

  // Toggle sentence guess
  const toggleSentenceGuess = (idx) => {
    if (!textPractice) return;
    setUserSentenceGuesses(prev => ({ ...prev, [idx]: !prev[idx] }));
  };

  // Reveal comparison: compute detailed matches and open modal with results
  const revealComparison = () => {
    if (!result) { alert("Run a scan first."); return; }
    const tokens = wordsWithIndexes(text);
    const aiSet = new Set((result.aiWords||[]).map(w=>w.toLowerCase()));
    const userMarkedTokenIdxs = Object.keys(userWordGuesses).filter(k=>userWordGuesses[k]).map(n=>Number(n));
    let wordMatches = [];
    userMarkedTokenIdxs.forEach(idx => {
      const t = tokens[idx] ? cleanToken(tokens[idx].text) : '';
      const matched = aiSet.has(t);
      wordMatches.push({ idx, token: tokens[idx] ? tokens[idx].text.trim() : '', matched });
    });

    // sentence matches
    const flaggedIdxs = new Set((result.flaggedSentences||[]).map(s=>s.idx));
    const userSentenceMarked = Object.keys(userSentenceGuesses).filter(k=>userSentenceGuesses[k]).map(n=>Number(n));
    let sentenceMatches = userSentenceMarked.map(i => ({ idx:i, matched: flaggedIdxs.has(i) }));

    // compute totals
    const totalWordMarked = wordMatches.length;
    const totalWordCorrect = wordMatches.filter(w=>w.matched).length;
    const totalSentMarked = sentenceMatches.length;
    const totalSentCorrect = sentenceMatches.filter(s=>s.matched).length;

    const assembled = {
      totalWordMarked, totalWordCorrect, wordMatches,
      totalSentMarked, totalSentCorrect, sentenceMatches,
      system: result
    };

    setRevealData(assembled);
    setShowRevealModal(true);
  };

  // quick practice examples (copy/paste)
  const practiceExamples = [
    { label: "AI - Corporate", text: "Our solution leverages synergy to optimize stakeholder alignment while mitigating downstream risks through a scalable ecosystem." },
    { label: "AI - Academic", text: "The phenomenon demonstrates a myriad of complex interdependencies that necessitate a multifaceted approach to mitigate downstream effects." },
    { label: "Human - Memory", text: "I remember that weird summer  the air smelled like tar and oranges, and Mom kept the radio on all day." },
    { label: "Human - Casual", text: "Nah, that movie was kinda trash. The soundtrack slaps though." }
  ];

  // small UI components: SentenceList
  const SentenceList = ({ content, analysis }) => {
    const sents = sentences(content);
    return (
      <div className="space-y-2">
        {sents.map(s => {
          const suspicious = analysis && analysis.flaggedSentences && analysis.flaggedSentences.find(f=>f.idx===s.idx);
          return (
            <div key={s.idx} className={`p-2 rounded-lg border ${suspicious ? 'border-indigo-600 bg-indigo-900/5' : 'border-slate-700'} flex items-start gap-3`}>
              <div className="flex-1 text-sm text-slate-300">
                <div className="whitespace-pre-wrap leading-relaxed">{s.text}</div>
                {suspicious && <div className="text-[11px] text-indigo-300 mt-1">Flag: {suspicious.buzzHits} buzzwords  score {suspicious.score}</div>}
              </div>

              <div className="text-xs flex flex-col items-center gap-1">
                <label className="flex items-center gap-1 text-slate-400">
                  <input
                    type="checkbox"
                    checked={!!userSentenceGuesses[s.idx]}
                    disabled={!textPractice}
                    onChange={() => toggleSentenceGuess(s.idx)}
                  />
                  <div className="text-[11px]">Suspect</div>
                </label>
              </div>
            </div>
          );
        })}
      </div>
    );
  };

  // small helper to load an example into the editor
  const loadExample = (ex) => {
    setText(ex.text);
    setResult(null);
    setUserWordGuesses({});
    setUserSentenceGuesses({});
  };

  // Main render
  return (
    <div className="space-y-8 animate-fade-in">
      <div className="grid lg:grid-cols-2 gap-8">
        <div className="flex flex-col h-full">
          <div className="flex justify-between items-center mb-4">
            <div>
              <h2 className="text-3xl font-black text-white">Deep Text Scanner</h2>
              <div className="text-xs text-slate-400">Paste text to analyze vocabulary clusters, burstiness, and other AI markers.</div>
            </div>

            <div className="flex items-center gap-3">
              <label className="flex items-center gap-2 bg-slate-900 px-3 py-2 rounded-lg border border-slate-700">
                <input
                  type="checkbox"
                  checked={textPractice}
                  onChange={() => setTextPractice(p => !p)}
                  className="w-4 h-4"
                />
                <div className="text-xs">
                  <div className="font-semibold text-slate-100">Practice Mode</div>
                  <div className="text-[11px] text-slate-400">Mark words/sentences you suspect are AI, then Run Scan  Reveal Comparison</div>
                </div>
              </label>

              <Button variant="secondary" className="text-xs" icon={Icons.Book} onClick={() => setShowCompare(true)}>View Style Comparison</Button>
            </div>
          </div>

          <p className="text-slate-300 mb-4">
            We compute multiple signals  lexical, syntactic and stylistic  to estimate how likely text was produced by a model. Use Practice Mode to test your intuition before checking system results.
          </p>

          <div className="mb-3 flex gap-2">
            {practiceExamples.map((ex, i) => (
              <button key={i} onClick={() => loadExample(ex)} className="px-3 py-1 rounded-lg bg-slate-900 text-xs text-slate-200 border border-slate-700 hover:bg-slate-800">
                {ex.label}
              </button>
            ))}
          </div>
          {/* --- EXPANDED TEXT CHECKLIST --- */}
          <div className="bg-slate-900/50 p-4 rounded-xl border border-slate-700 mb-4">
              <h4 className="font-bold text-indigo-400 mb-3 text-sm uppercase tracking-wider flex items-center gap-2">
                  <Icon path={Icons.List} size={16} /> Forensic Observation Checklist
              </h4>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {[
                  { id: 'repetitive', label: 'Repetitive Phrasing', desc: 'Repeating key terms/structures.' },
                  { id: 'connectors', label: 'Overused Connectors', desc: '"Furthermore", "In conclusion".' },
                  { id: 'grammar', label: 'Unnatural Perfection', desc: 'No errors, robotic flow.' },
                  { id: 'generic', label: 'Vague / Buzzwords', desc: '"Synergy", "Landscape", "Delve".' },
                  { id: 'emotion', label: 'Lack of Personal Anecdotes', desc: 'No specific sensory details.' },
                  { id: 'hedging', label: 'Excessive Hedging', desc: '"It is important to note..."' },
                  { id: 'formatting', label: 'Uniform Structure', desc: 'Perfect bullet points or length.' }
                ].map(item => (
                  <label key={item.id} className={`flex items-start gap-3 p-2.5 rounded-lg border cursor-pointer transition-all ${textChecklist[item.id] ? 'bg-indigo-900/20 border-indigo-500/50' : 'bg-slate-800 border-slate-700 hover:border-slate-600'}`}>
                    <div className="pt-0.5">
                      <input 
                        type="checkbox" 
                        className="w-4 h-4 rounded border-slate-500 text-indigo-500 focus:ring-indigo-500 bg-slate-700"
                        checked={textChecklist[item.id]}
                        onChange={() => setTextChecklist(prev => ({...prev, [item.id]: !prev[item.id]}))}
                      />
                    </div>
                    <div>
                      <span className={`font-bold text-xs block ${textChecklist[item.id] ? 'text-indigo-300' : 'text-slate-300'}`}>{item.label}</span>
                      <span className="text-[10px] text-slate-500 leading-tight block mt-0.5">{item.desc}</span>
                    </div>
                  </label>
                ))}
              </div>
          </div>

          <div className="relative flex-grow min-h-[420px]">
            {result ? (
              <div className="w-full h-full p-6 rounded-2xl bg-slate-800 border border-slate-700 shadow-inner overflow-y-auto font-mono text-sm">
                <HighlightedText content={text} analysis={result} />
                <div className="mt-4">
                  <div className="text-xs text-slate-400 mb-2">Sentences (mark suspects):</div>
                  <SentenceList content={text} analysis={result} />
                </div>
              </div>
            ) : (
              <textarea
                className="w-full h-full p-6 rounded-2xl bg-slate-800 border border-slate-700 focus:ring-2 focus:ring-indigo-500 outline-none resize-none font-mono text-sm leading-relaxed shadow-inner text-white placeholder-slate-500"
                placeholder="Paste suspicious email or essay text here..."
                value={text}
                onChange={(e) => setText(e.target.value)}
              />
            )}

            {isScanning && <div className="absolute inset-0 bg-slate-900/50 flex items-center justify-center rounded-2xl backdrop-blur-sm z-10"><div className="animate-spin rounded-full h-12 w-12 border-4 border-indigo-600 border-t-transparent"></div></div>}
          </div>

          <div className="mt-4 flex gap-3">
            <Button onClick={analyze} disabled={text.length < 50 || isScanning} icon={Icons.Search} className="flex-1">
              {isScanning ? "Processing..." : "Run Deep Scan"}
            </Button>
            {result && <Button variant="secondary" onClick={() => { setResult(null); setUserWordGuesses({}); setUserSentenceGuesses({}); }} icon={Icons.RefreshCw}>Reset</Button>}
            <Button variant="ghost" onClick={revealComparison} disabled={!result} icon={Icons.Check}>Reveal Comparison</Button>
          </div>
        </div>

        <div className="space-y-6">
          {result ? (
            <div className="space-y-6 animate-fade-in">
              <Card className="text-center relative overflow-hidden border-0 bg-gradient-to-br from-slate-900 to-slate-800 text-white">
                <div className="relative z-10">
                  <div className="text-sm font-bold uppercase tracking-widest text-slate-400 mb-2">Synthetic Probability</div>
                  <div className={`text-6xl font-black mb-2 ${result.score > 70 ? 'text-purple-400' : result.score > 40 ? 'text-yellow-400' : 'text-green-400'}`}>
                    {result.score}%
                  </div>
                  <div className="inline-block px-3 py-1 rounded-full bg-white/10 text-sm font-medium">
                    {result.score > 70 ? "High Likelihood" : result.score > 40 ? "Indeterminate" : "Likely Human"}
                  </div>
                </div>
              </Card>

              <div className="grid grid-cols-2 gap-4">
                <Card title="Burstiness" className="text-center">
                  <div className="text-2xl font-bold mb-1 text-white">{result.burstiness}</div>
                  <div className="text-[10px] text-slate-500 uppercase">Variance Score</div>
                  <div className={`mt-2 h-1 w-full rounded-full ${result.burstiness < 6 ? 'bg-red-500' : 'bg-green-500'}`}></div>
                  <p className="text-[10px] mt-1 text-slate-400">{result.burstiness < 6 ? "Robotic / Uniform" : "Human / Chaotic"}</p>
                </Card>
                <Card title="Vocabulary" className="text-center">
                  <div className="text-2xl font-bold mb-1 text-white">{result.buzzCount}</div>
                  <div className="text-[10px] text-slate-500 uppercase">Buzzwords Found</div>
                  <div className="mt-2 h-1 w-full rounded-full bg-blue-500"></div>
                  <p className="text-[10px] mt-1 text-slate-400">{result.aiWords && result.aiWords.length ? result.aiWords.join(', ') : ''}</p>
                </Card>
              </div>

              <Card title="Advanced Metrics">
                <div className="grid grid-cols-2 gap-3 text-sm text-slate-300">
                  <div><strong>Type-token ratio:</strong> {result.typeTokenRatio}</div>
                  <div><strong>Avg word len:</strong> {result.avgWordLen ?? result.avgWordLen}</div>
                  <div><strong>Contractions:</strong> {result.contractionCount}</div>
                  <div><strong>Punct. complexity:</strong> {result.punctuationComplexity}</div>
                  <div className="col-span-2"><strong>Repeated words:</strong> {result.repeatedWords.length ? result.repeatedWords.join(', ') : ''}</div>
                </div>
              </Card>

              <Card title="Micro Checklist">
                <div className="space-y-2 text-sm text-slate-300">
                  <div><strong>Vocabulary:</strong> many rare/academic or corporate words in a short span? (myriad, leverage)</div>
                  <div><strong>Opinion & Specificity:</strong> are there personal anchors  names, dates, sensory detail?</div>
                  <div><strong>Punctuation & Rhythm:</strong> perfectly uniform sentences and connectors are suspicious.</div>
                  <div><strong>Typos & Idiosyncrasies:</strong> humans occasionally make mistakes; AI often does not.</div>
                  <div><strong>Practice:</strong> mark tokens & sentences in Practice Mode, then Reveal Comparison to see what you got right.</div>
                </div>
              </Card>
            </div>
          ) : (
            <Card className="h-full flex flex-col items-center justify-center text-center p-12 opacity-50 border-dashed">
              <div className="mb-4 text-slate-600"><Icon path={Icons.Terminal} size={64} /></div>
              <h3 className="text-lg font-bold text-slate-400">Analysis Pending</h3>
              <p className="text-sm text-slate-400">Metrics will appear here after scan.</p>
            </Card>
          )}
        </div>
      </div>

      {/* Human vs AI Writing Style Modal (expanded) */}
      <Modal isOpen={showCompare} onClose={() => setShowCompare(false)} title="Human vs. AI Writing Style">
        <div className="grid md:grid-cols-2 gap-6">
          <div className="bg-slate-800 p-4 rounded-xl border border-indigo-500/30">
            <Badge color="purple">AI Generated  Common Patterns</Badge>
            <div className="mt-3 space-y-3 text-sm text-slate-300">
              <p><strong>Verbose academic:</strong> "The phenomenon demonstrates a myriad of complex interdependencies that necessitate a multifaceted approach to mitigate downstream effects." <span className="text-xs text-slate-500"> markers: 'myriad', 'necessitate', 'downstream'</span></p>
              <p><strong>Corporate-speak:</strong> "Our solution leverages synergy to optimize stakeholder alignment while mitigating downstream risks through a scalable ecosystem." <span className="text-xs text-slate-500"> markers: 'leverage', 'synergy', 'scalable ecosystem'</span></p>
              <p><strong>Neutral wrap-up:</strong> "In conclusion, it is important to note that further research is required." <span className="text-xs text-slate-500"> markers: 'in conclusion', hedging phrases</span></p>
              <p className="text-xs text-slate-400"><strong>Clues (AI):</strong> repeated rare vocabulary, near-perfect grammar, uniform sentence lengths, formal connectors, and lack of personal/sensory detail.</p>
            </div>
          </div>

          <div className="bg-slate-800 p-4 rounded-xl border border-green-500/30">
            <Badge color="green">Human Written  Common Patterns</Badge>
            <div className="mt-3 space-y-3 text-sm text-slate-300">
              <p><strong>Casual memory:</strong> "I remember that weird summer  the air smelled like tar and oranges, and Mom kept the radio on all day." <span className="text-xs text-slate-500"> sensory detail, specific memory</span></p>
              <p><strong>Opinionated snip:</strong> "Nah, that movie was kinda trash. The soundtrack slaps though." <span className="text-xs text-slate-500"> slang, contractions</span></p>
              <p><strong>Broken recall:</strong> "I cant remember the name  might be spelled wrong, but I think it was 'Katherine'?" <span className="text-xs text-slate-500"> typos, uncertainty</span></p>
              <p className="text-xs text-slate-400"><strong>Clues (Human):</strong> contractions, colloquial phrasing, typos, specific sensory anchors, and variable rhythm.</p>
            </div>
          </div>

          <div className="md:col-span-2 bg-slate-900 p-4 rounded-xl border border-slate-700 space-y-3">
            <div className="font-bold text-slate-100">Practice & Tips  How to get better fast</div>
            <div className="text-xs text-slate-400 space-y-2">
              <div><strong>Tip 1:</strong> Read paragraphs aloud  AI text often "flows" too smoothly; humans hesitate and slip in style.</div>
              <div><strong>Tip 2:</strong> Search for sensory detail (sight, smell, time); absence is suspicious.</div>
              <div><strong>Tip 3:</strong> Watch for hedging connectors ("in conclusion", "it is important to note").</div>
              <div><strong>Tip 4:</strong> Typos & slang increase human-likelihood; perfect grammar in casual contexts is suspicious.</div>
              <div><strong>Exercise:</strong> Use Practice Mode, mark tokens & sentences you suspect, run Scan, then press Reveal Comparison  review misses and learn patterns.</div>
            </div>
          </div>
        </div>
      </Modal>

      {/* Reveal Comparison Modal (replaces alert) */}
      <Modal isOpen={showRevealModal} onClose={() => { setShowRevealModal(false); setRevealData(null); }} title="Practice Results  Reveal Comparison">
        {revealData ? (
          <div className="space-y-4 text-sm text-slate-300">
            <div className="flex justify-between items-center">
              <div>
                <div className="text-xs text-slate-400">Words marked</div>
                <div className="font-bold">{revealData.totalWordMarked} marked  {revealData.totalWordCorrect} correct</div>
              </div>
              <div>
                <div className="text-xs text-slate-400">Sentences marked</div>
                <div className="font-bold">{revealData.totalSentMarked} marked  {revealData.totalSentCorrect} correct</div>
              </div>
            </div>

            <div>
              <div className="text-xs text-slate-400 mb-1">Word details</div>
              <div className="max-h-36 overflow-y-auto space-y-1">
                {revealData.wordMatches.length === 0 ? <div className="text-xs text-slate-500">You didn't mark any words.</div> :
                  revealData.wordMatches.map((w,i) => (
                    <div key={i} className={`p-2 rounded ${w.matched ? 'bg-green-900/10 border border-green-700' : 'bg-red-900/5 border border-red-700'}`}>
                      <div className="flex justify-between items-center">
                        <div><strong>{w.token || '(whitespace)'} </strong> <span className="text-xs text-slate-400"> token idx {w.idx}</span></div>
                        <div className="text-xs">{w.matched ? 'Matched AI token ' : 'No match '}</div>
                      </div>
                    </div>
                  ))
                }
              </div>
            </div>

            <div>
              <div className="text-xs text-slate-400 mb-1">Sentence details</div>
              <div className="max-h-40 overflow-y-auto space-y-1">
                {revealData.sentenceMatches.length === 0 ? <div className="text-xs text-slate-500">You didn't mark any sentences.</div> :
                  revealData.sentenceMatches.map((s,i) => (
                    <div key={i} className={`p-2 rounded ${s.matched ? 'bg-green-900/10 border border-green-700' : 'bg-red-900/5 border border-red-700'}`}>
                      <div className="flex justify-between items-center">
                        <div className="text-xs">Sentence idx {s.idx}</div>
                        <div className="text-xs">{s.matched ? 'Matched system flag ' : 'Not flagged by system '}</div>
                      </div>
                    </div>
                  ))
                }
              </div>
            </div>

            <div className="text-xs text-slate-400">
              <strong>System summary:</strong> {revealData.system.score}% AI likelihood  Buzzwords: {revealData.system.aiWords.join(', ') || ''}  Repeated: {revealData.system.repeatedWords.join(', ') || ''}
            </div>

            <div className="text-xs text-slate-400 space-y-1">
              <div><strong>Actionable tip:</strong> If you missed AI tokens, focus on rare/academic words and connectors. If you missed flagged sentences, look for perfect structure and hedging wrap-ups.</div>
              <div><strong>Next step:</strong> Try another example from the top-left presets or paste a clip from an email/article and repeat.</div>
            </div>

            <div className="flex justify-end gap-2">
              <Button onClick={() => { setShowRevealModal(false); setRevealData(null); }}>Close</Button>
            </div>
          </div>
        ) : (
          <div className="text-slate-400">No results to show.</div>
        )}
      </Modal>
    </div>
  );
};

const LandingPage = ({ onStart }) => {
            // Generate Stars
            const stars = useMemo(() => {
                return [...Array(60)].map((_, i) => ({
                    id: i,
                    top: `${Math.random() * 100}%`,
                    left: `${Math.random() * 100}%`,
                    size: `${Math.random() * 3 + 1}px`,
                    delay: `${Math.random() * 5}s`,
                    duration: `${Math.random() * 3 + 2}s`
                }));
            }, []);

            // Generate "Matrix" Data Particles
            const particles = useMemo(() => {
                return [...Array(20)].map((_, i) => ({
                    id: `p-${i}`,
                    left: `${Math.random() * 100}%`,
                    content: Math.random() > 0.5 ? '1' : '0',
                    duration: `${Math.random() * 10 + 5}s`,
                    delay: `${Math.random() * 5}s`
                }));
            }, []);

            return (
                <div className="min-h-screen relative overflow-x-hidden overflow-y-auto font-sans">
                    {/* --- BACKGROUND LAYERS --- */}
                    <div className="galaxy-bg"></div>
                    <div className="cyber-grid"></div>
                    
                    {/* Stars */}
                    {stars.map(star => (
                        <div key={star.id} className="star z-0" 
                            style={{ 
                                top: star.top, left: star.left, width: star.size, height: star.size, 
                                animationDelay: star.delay, animationDuration: star.duration
                            }} 
                        />
                    ))}

                    {/* Floating Data Particles */}
                    {particles.map(p => (
                        <div key={p.id} className="data-particle z-0" 
                            style={{ 
                                left: p.left, animationDuration: p.duration, animationDelay: p.delay 
                            }}
                        >
                            {p.content}
                        </div>
                    ))}

                    {/* --- MAIN CONTENT CONTAINER --- */}
                    <div className="relative z-10 min-h-screen flex flex-col items-center justify-center p-6 py-12 md:py-20">
                        <div className="max-w-6xl w-full flex flex-col items-center text-center space-y-12 animate-fade-in">
                            
                            {/* Floating Logo */}
                            <div className="animate-float">
                                <div className="inline-flex items-center justify-center p-8 rounded-full bg-indigo-500/10 backdrop-blur-xl border border-indigo-400/30 shadow-[0_0_100px_rgba(79,70,229,0.2)]">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#818cf8" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                        <path d="M12 8v4"/>
                                        <path d="M12 16h.01"/>
                                    </svg>
                                </div>
                            </div>

                            {/* Title */}
                            <div className="space-y-4">
                                <div className="flex items-center justify-center gap-3">
                                    <div className="h-[1px] w-12 bg-indigo-500/50"></div>
                                    <span className="text-indigo-400 font-mono font-bold tracking-[0.3em] text-xs uppercase glow">System Online</span>
                                    <div className="h-[1px] w-12 bg-indigo-500/50"></div>
                                </div>
                                <h1 className="text-5xl md:text-8xl font-black text-white tracking-tighter drop-shadow-2xl">
                                    AI SENTINEL
                                    <span className="block text-xl md:text-3xl mt-4 font-light text-indigo-200 tracking-widest opacity-80">ENTERPRISE EDITION</span>
                                </h1>
                            </div>

                            {/* Intro Text */}
                            <div className="glass-panel p-8 md:p-10 rounded-3xl border-t border-white/10 bg-gradient-to-b from-slate-900/50 to-indigo-900/10 max-w-4xl mx-auto shadow-2xl backdrop-blur-xl">
                                <p className="text-lg md:text-2xl text-indigo-50 leading-relaxed font-light font-sans">
                                    "We live in an era where a mother's voice can be synthesized in seconds, and a stranger's face can be worn like a mask. The digital universe is expanding, but so are the shadows where truth hides."
                                </p>
                                <div className="h-px w-full bg-gradient-to-r from-transparent via-indigo-500/30 to-transparent my-8"></div>
                                <p className="text-lg md:text-xl text-slate-300 leading-relaxed">
                                    From protecting our grandparents from phantom calls to guiding the youth through a maze of algorithms, our mission is simple: <span className="text-white font-bold drop-shadow-md">To ensure that in a world of artificial intelligence, human connection remains authentic.</span>
                                </p>
                            </div>

                            {/* Feature Overview Board */}
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 w-full max-w-5xl">
                                {[
{ title: "Visual Forensics", desc: "Detect deepfake anomalies in facial structure and lighting.", icon: <><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></> },                                    { title: "Voice Analysis", desc: "Identify synthetic audio patterns and robotic artifacts.", icon: <><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></> },
                                    { title: "Text Scanner", desc: "Analyze writing for LLM vocabulary and low entropy.", icon: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></> },
                                    { title: "Scam Defense", desc: "Learn strategies to defeat social engineering attacks.", icon: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/> }
                                ].map((feature, i) => (
                                    <div key={i} className="feature-card p-6 rounded-2xl flex flex-col items-center text-center">
                                        <div className="p-3 bg-indigo-500/20 rounded-xl mb-3 text-indigo-300">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{feature.icon}</svg>
                                        </div>
                                        <h3 className="font-bold text-white mb-1">{feature.title}</h3>
                                        <p className="text-xs text-slate-400">{feature.desc}</p>
                                    </div>
                                ))}
                            </div>

                            {/* Action Area */}
                            <div className="pt-6 pb-12">
                                <button 
                                    onClick={onStart}
                                    className="group relative px-12 py-5 bg-white/5 hover:bg-indigo-600/20 backdrop-blur-md border border-white/10 hover:border-indigo-400/50 rounded-full font-bold text-lg text-white transition-all duration-300 hover:scale-105 hover:shadow-[0_0_40px_rgba(99,102,241,0.4)] flex items-center gap-3 overflow-hidden"
                                >
                                    <span className="relative z-10 tracking-widest">INITIALIZE SYSTEM</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="group-hover:translate-x-1 transition-transform relative z-10 text-indigo-400">
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                        <polyline points="12 5 19 12 12 19"></polyline>
                                    </svg>
                                    <div className="absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-700 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12"></div>
                                </button>
                            </div>

                            {/* Credits */}
                            <div className="mt-auto pt-8 flex flex-col items-center">
                                <div className="inline-block px-8 py-4 rounded-2xl glass-panel border-white/5 bg-black/20">
                                    <p className="text-[10px] text-indigo-300 font-bold tracking-[0.2em] uppercase mb-2">System Architect</p>
                                    <p className="text-white text-base font-bold tracking-wide">Nhat Nam Do</p>
                                    <p className="text-slate-400 text-xs mt-1 font-mono hover:text-indigo-400 transition-colors cursor-pointer">namdok2k3@gmail.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        // --- DASHBOARD (Expanded with Live Threats) ---
        const Dashboard = ({ userXP, userLevel, setView }) => {
            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="relative overflow-hidden rounded-3xl bg-indigo-600 text-white p-8 md:p-12 shadow-xl shadow-none">
                        <div className="relative z-10 max-w-2xl">
                            <Badge color="purple">Enterprise Edition v5.3</Badge>
                            <h1 className="text-4xl md:text-6xl font-black mt-4 mb-6 leading-tight">
                                Artificial Intelligence <br/>Defense Systems
                            </h1>
                            <p className="text-indigo-100 text-lg md:text-xl mb-8 leading-relaxed">
                                Elite-grade tools for detecting synthetic media, analyzing linguistic patterns, and protecting institutional integrity.
                            </p>
                            <div className="flex flex-wrap gap-4">
                                <Button variant="secondary" onClick={() => setView('visuals')} icon={Icons.Eye}>Launch Visual Inspector</Button>
                                <Button variant="secondary" onClick={() => setView('voice')} icon={Icons.Mic}>Open Voice Lab</Button>
                                <Button variant="secondary" onClick={() => setView('text')} icon={Icons.Search}>Deep Text Scan</Button>
                                <Button variant="secondary" onClick={() => setView('learn')} icon={Icons.Book}>Academy</Button>
                            </div>
                        </div>
                        <div className="absolute right-0 top-0 h-full w-1/2 opacity-10 pointer-events-none">
                             <div className="w-full h-full bg-gradient-to-l from-black to-transparent"></div>
                        </div>
                    </div>

                    {/* NEW ACTIVE THREATS COMPONENT */}
                    <ActiveThreats />

                    <div className="grid lg:grid-cols-3 gap-8">
                        {/* Status Column */}
                        <div className="space-y-6">
                            <Card title="User Status" icon={Icons.Award}>
                                <div className="flex justify-between items-end mb-2">
                                    <span className="text-2xl font-bold text-white">Level {userLevel}</span>
                                    <span className="text-sm font-bold text-indigo-400">{userXP} / {userLevel * 200} XP</span>
                                </div>
                                <ProgressBar value={userXP} max={userLevel * 200} />
                                <div className="mt-4 grid grid-cols-2 gap-4 text-center">
                                    <div className="bg-slate-800 p-2 rounded-lg">
                                        <div className="text-xl font-bold text-white">12</div>
                                        <div className="text-xs text-slate-500">Scans Run</div>
                                    </div>
                                    <div className="bg-slate-800 p-2 rounded-lg">
                                        <div className="text-xl font-bold text-white">3</div>
                                        <div className="text-xs text-slate-500">Badges</div>
                                    </div>
                                </div>
                            </Card>
                            <Card title="Glossary of Terms" icon={Icons.Book}>
                                <div className="h-64 overflow-y-auto pr-2 space-y-3 custom-scrollbar">
                                    {GLOSSARY.map((item, i) => (
                                        <div key={i} className="p-3 rounded-lg bg-slate-800 hover:bg-slate-700 transition-colors">
                                            <div className="font-bold text-sm text-indigo-400 mb-1">{item.term}</div>
                                            <div className="text-xs text-slate-300 leading-relaxed">{item.def}</div>
                                        </div>
                                    ))}
                                </div>
                            </Card>
                        </div>

                        {/* Feed Column */}
                        <div className="lg:col-span-2 space-y-6">
                            <h3 className="font-bold text-xl text-white flex items-center gap-2">
                                <Icon path={Icons.List} /> Live Intelligence Feed
                            </h3>
                            <div className="grid md:grid-cols-2 gap-4">
                                {NEWS_FEED.map(item => (
                                    <a href={item.url} key={item.id} target="_blank" rel="noreferrer" className="block">
                                        <Card className="hover:border-indigo-500 transition-colors cursor-pointer group h-full">
                                            <div className="flex justify-between items-start mb-3">
                                                <Badge color={item.tag === 'SCAM ALERT' ? 'red' : item.tag === 'SECURITY' ? 'green' : 'blue'}>{item.tag}</Badge>
                                                <span className="text-xs text-slate-400 font-mono">{item.date}</span>
                                            </div>
                                            <h4 className="font-bold text-lg mb-2 text-white group-hover:text-indigo-400 transition-colors">{item.title}</h4>
                                            <p className="text-sm text-slate-400 leading-relaxed mb-4">{item.content}</p>
                                            <div className="flex items-center text-indigo-500 text-xs font-bold mt-auto">
                                                Read Analysis <Icon path={Icons.ArrowRight} size={14} className="ml-1" />
                                            </div>
                                        </Card>
                                    </a>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

// --- APP SHELL ---
        const App = () => {
            const [hasStarted, setHasStarted] = useState(false); // NEW: Track start state
            
            const [view, setView] = useState('home');
            const [userXP, setUserXP] = useState(350);
            const [userLevel, setUserLevel] = useState(3);
            const [activeCourse, setActiveCourse] = useState(null);
            const [quizAnswers, setQuizAnswers] = useState({});
            const [showQuizResult, setShowQuizResult] = useState(null);

            // Force dark mode
            useEffect(() => { document.body.className = 'dark'; }, []);

            // SHOW LANDING PAGE FIRST
            if (!hasStarted) {
                return <LandingPage onStart={() => setHasStarted(true)} />;
            }

            return (
                <div className="min-h-screen flex flex-col md:flex-row max-w-[1600px] mx-auto md:p-6 gap-6">
                    {/* Sidebar */}
                    <nav className="hidden md:flex flex-col w-72 glass rounded-3xl p-6 h-[calc(100vh-3rem)] sticky top-6 transition-all">
                        <div className="flex items-center gap-3 mb-10 px-2">
                            <div className="bg-indigo-600 text-white p-2 rounded-xl shadow-lg shadow-indigo-500/30"><Icon path={Icons.Shield} size={28} /></div>
                            <div>
                                <span className="font-black text-xl tracking-tight text-white block">AI<span className="text-indigo-600">Sentinel</span></span>
                                <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Enterprise</span>
                            </div>
                        </div>

                        <div className="space-y-2 flex-1 overflow-y-auto pr-2 custom-scrollbar">
                            <div className="text-xs font-bold text-slate-400 uppercase tracking-widest px-4 mb-2 mt-4">Modules</div>
                            {[
                                { id: 'home', label: 'Dashboard', icon: Icons.Home },
                                { id: 'visuals', label: 'Visual Forensics', icon: Icons.Eye },
                                { id: 'text', label: 'Text Analysis', icon: Icons.Search },
                                { id: 'voice', label: 'Voice Forensics', icon: Icons.Mic },
                                { id: 'scams', label: 'Scam Defense', icon: Icons.Lock },
                                { id: 'optimizer', label: 'Prompt Optimizer', icon: Icons.Wand },
                                { id: 'learn', label: 'Academy', icon: Icons.Book }
                            ].map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => setView(item.id)}
                                    className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-xl font-bold transition-all ${view === item.id ? 'bg-indigo-600 text-white shadow-none' : 'text-slate-400 hover:bg-slate-800'}`}
                                >
                                    <Icon path={item.icon} size={20} />
                                    {item.label}
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 p-4 md:p-0 overflow-y-auto">
                        {/* Mobile Header */}
                        <div className="md:hidden glass p-4 rounded-xl mb-4 flex justify-between items-center sticky top-4 z-50">
                            <span className="font-black text-lg text-white">AI<span className="text-indigo-600">Sentinel</span></span>
                        </div>

                        {view === 'home' && <Dashboard userXP={userXP} userLevel={userLevel} setView={setView} />}
                        {view === 'visuals' && <VisualForensics />}
                        {view === 'text' && <TextForensics />}
                        {view === 'voice' && <VoiceForensics />}
                        {view === 'optimizer' && <PromptOptimizer />}
                        
                        {view === 'learn' && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="flex justify-between items-end">
                                    <div>
                                        <h2 className="text-3xl font-black text-white">Academy Library</h2>
                                        <p className="text-slate-400 mt-2">Professional certification modules for AI literacy.</p>
                                    </div>
                                </div>
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {COURSES.map(course => (
                                        <Card key={course.id} className="group hover:border-indigo-500 transition-colors cursor-pointer h-full flex flex-col justify-between">
                                            <div onClick={() => { 
                                                setActiveCourse(course); 
                                                setShowQuizResult(null); 
                                                setQuizAnswers({}); 
                                            }}>
                                                <div className="flex items-center justify-between mb-4">
                                                    <Badge color={course.category.includes("Scam") ? "red" : course.category.includes("Visual") ? "purple" : "blue"}>{course.category}</Badge>
                                                    <div className="flex items-center gap-1 text-xs font-bold text-slate-400">
                                                        <Icon path={Icons.Zap} size={14} /> {course.xp} XP
                                                    </div>
                                                </div>
                                                <h3 className="font-bold text-xl text-white mb-2 group-hover:text-indigo-600 transition-colors">{course.title}</h3>
                                                <div className="flex items-center gap-4 text-sm text-slate-500">
                                                    <span>Level: {course.level}</span>
                                                    <span></span>
                                                    <span>{course.duration}</span>
                                                </div>
                                                <div className="mt-6 flex items-center text-indigo-600 font-bold text-sm">
                                                    Start Module <Icon path={Icons.ArrowRight} size={16} className="ml-2 group-hover:translate-x-1 transition-transform" />
                                                </div>
                                            </div>
                                        </Card>
                                    ))}
                                </div>
                            </div>
                        )}

                       {view === 'scams' && (
    <div className="space-y-8 animate-fade-in pb-20">
        <div className="flex flex-col md:flex-row justify-between items-end gap-4 border-b border-slate-700 pb-6">
            <div>
                <h2 className="text-4xl font-black text-white">Threat Defense Matrix</h2>
                <p className="text-slate-400 mt-2">Active database of <span className="text-indigo-400 font-bold">50+ known social engineering vectors</span> and defense protocols.</p>
            </div>
            {/* SEARCH & FILTER UI */}
            <div className="flex gap-2 w-full md:w-auto">
                 <div className="relative flex-1 md:w-64">
                    <Icon path={Icons.Search} size={16} className="absolute left-3 top-3.5 text-slate-500" />
                    <input 
                        type="text" 
                        placeholder="Search threats..." 
                        className="w-full bg-slate-800 border border-slate-700 rounded-xl py-3 pl-10 pr-4 text-sm text-white focus:ring-2 focus:ring-indigo-500 outline-none"
                        onChange={(e) => {
                            const val = e.target.value.toLowerCase();
                            const cards = document.querySelectorAll('.scam-card');
                            cards.forEach(card => {
                                const text = card.textContent.toLowerCase();
                                card.style.display = text.includes(val) ? 'flex' : 'none';
                            });
                        }}
                    />
                 </div>
            </div>
        </div>
        
        {/* MASSIVE SCAM DATABASE MAPPED INLINE */}
        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 auto-rows-fr">
            {[
                // --- CATEGORY: URGENT / AUTHORITY ---
                { title: "The 3-Second Clone", icon: Icons.Mic, color: "red", tag: "AI Voice", hook: "Relative in jail/hospital calling you.", tech: "Voice cloning from 3s social media clips.", defense: "Ask for a pre-agreed 'Safe Word'." },
                { title: "Grandparent Scam", icon: Icons.User, color: "red", tag: "Social", hook: "'Grandma, I'm in trouble, don't tell mom.'", tech: "Emotional manipulation + poor audio quality excuses.", defense: "Call the parents/guardians to verify." },
                { title: "The Jury Duty Warrant", icon: Icons.Shield, color: "orange", tag: "Authority", hook: "Police call: 'You missed jury duty. Pay fine or arrest.'", tech: "Spoofed Caller ID matching local police.", defense: "Real police NEVER call for fines. Hang up." },
                { title: "IRS Tax Debt", icon: Icons.FileText, color: "orange", tag: "Authority", hook: "Robocall: 'Your SSN is suspended due to tax fraud.'", tech: "Fear induction.", defense: "The IRS sends letters, never calls. Check irs.gov." },
                { title: "Utilities Shutoff", icon: Icons.Zap, color: "yellow", tag: "Urgency", hook: "Power/Water company: 'Pay in 30 mins or we cut power.'", tech: "Timing (usually Friday afternoons).", defense: "Hang up. Call the number on your actual utility bill." },
                { title: "ICE / Immigration Threat", icon: Icons.Globe, color: "red", tag: "Authority", hook: "Threat of deportation unless 'bond' is paid.", tech: "Targeting immigrant communities.", defense: "Immigration does not take payment over phone." },
                { title: "Kidnapping Hoax", icon: Icons.Alert, color: "red", tag: "Extreme", hook: "Screaming voice in background: 'We have your daughter.'", tech: "Stock screaming audio or AI voice.", defense: "Call/Text the 'kidnapped' person immediately." },

                // --- CATEGORY: TECH / MALWARE ---
                { title: "The Browser Locker", icon: Icons.Lock, color: "blue", tag: "Tech Support", hook: "Loud siren + 'VIRUS DETECTED' fullscreen popup.", tech: "HTML Fullscreen API (Not a real virus).", defense: "Hold Power Button 5s or press Esc. Do not call." },
                { title: "Fake CAPTCHA Malware", icon: Icons.Terminal, color: "purple", tag: "Malware", hook: "'Verify you are human: Press Win+R, paste this code.'", tech: "PowerShell script injection.", defense: "NEVER paste code into the 'Run' box." },
                { title: "Quishing (QR Phishing)", icon: Icons.Target, color: "indigo", tag: "Phishing", hook: "Parking meter sticker or '2FA Reset' email QR.", tech: "QR codes bypass email text filters.", defense: "Inspect URL preview before opening." },
                { title: "Geek Squad Invoice", icon: Icons.FileText, color: "slate", tag: "Phishing", hook: "Email: 'You were charged $499 for renewal.'", tech: "Induces panic to make you call their 'refund' center.", defense: "Check your actual bank statement first." },
                { title: "AnyDesk / TeamViewer", icon: Icons.Monitor, color: "red", tag: "Remote Access", hook: "'Let me connect to your PC to fix the hack.'", tech: "Remote Access Trojans (RAT).", defense: "NEVER grant remote access to a cold caller." },
                { title: "Google Voice Code", icon: Icons.Mic, color: "blue", tag: "2FA", hook: "'I sent a code to prove you are real. Read it to me.'", tech: "They are setting up a Google Voice # using YOUR phone.", defense: "Never share a 6-digit code sent to you." },
                { title: "The 'Clickfix' Infection", icon: Icons.Monitor, color: "purple", tag: "Malware", hook: "Fake 'Word Update' or 'Chrome Update' popup on websites.", tech: "Drive-by download.", defense: "Only update apps via their official settings menu." },
                { title: "Fake Zoom Installer", icon: Icons.Video, color: "blue", tag: "Malware", hook: "Google Ad for 'Zoom Download' leads to fake site.", tech: "SEO Poisoning.", defense: "Check URL carefully. Use zoom.us only." },

                // --- CATEGORY: FINANCIAL / CRYPTO ---
                { title: "Pig Butchering", icon: Icons.Heart, color: "pink", tag: "Crypto", hook: "Romance + 'I can teach you to trade crypto'.", tech: "Fake trading apps showing massive profits.", defense: "No video call = Scam. Never trust 'guaranteed' returns." },
                { title: "Rug Pull", icon: Icons.TrendingUp, color: "pink", tag: "Crypto", hook: "New coin/NFT project with massive hype.", tech: "Devs drain liquidity pool.", defense: "Check contract audits and team dox status." },
                { title: "Metamask 'Verify'", icon: Icons.Lock, color: "orange", tag: "Crypto", hook: "Email/DM: 'Verify your wallet to avoid suspension.'", tech: "Drainer script steals seed phrase.", defense: "Wallets NEVER need verification. Never share seed phrase." },
                { title: "Fake Airdrop", icon: Icons.Gift, color: "green", tag: "Crypto", hook: "Free tokens appearing in your wallet.", tech: "Interacting with the token triggers a drainer.", defense: "Ignore/Hide unknown tokens. Do not swap them." },
                { title: "Zelle 'Business' Upgrade", icon: Icons.Briefcase, color: "purple", tag: "Banking", hook: "FB Marketplace buyer: 'I need to pay you extra to upgrade account.'", tech: "Fake email confirmation.", defense: "Zelle has no 'Business Upgrade' fee." },
                { title: "Check Overpayment", icon: Icons.FileText, color: "green", tag: "Banking", hook: "They send a check for $2000, ask you to wire back $500.", tech: "The check will bounce weeks later.", defense: "Wait 30 days for check to fully clear." },
                { title: "PayPal 'Friends & Family'", icon: Icons.CreditCard, color: "blue", tag: "Banking", hook: "Seller asks for F&F payment to 'save fees'.", tech: "Removes Buyer Protection.", defense: "Always use 'Goods & Services' for strangers." },
                
                // --- CATEGORY: EMPLOYMENT / TASKS ---
                { title: "Task Fraud", icon: Icons.Briefcase, color: "emerald", tag: "Job Scam", hook: "'Earn $200/hr clicking buttons/optimizing apps.'", tech: "Fake dashboard. Requires 'deposit' to withdraw pay.", defense: "Real jobs do not ask you to pay to work." },
                { title: "LinkedIn Voice Harvest", icon: Icons.Mic, color: "blue", tag: "Corporate", hook: "Fake recruiter calls, asks basic Qs, hangs up.", tech: "Recording voice for AI banking bypass.", defense: "Verify recruiter profile first." },
                { title: "The Car Wrap", icon: Icons.Truck, color: "yellow", tag: "Job Scam", hook: "'Get paid $500/week to wrap your car with Red Bull ads.'", tech: "Fake check for 'wrap specialist' (who is the scammer).", defense: "Red Bull does not hire random cars." },
                { title: "Modeling Scout", icon: Icons.Camera, color: "pink", tag: "Exploitation", hook: "DM: 'You have the look. Pay for a portfolio shoot.'", tech: "Advance fee fraud.", defense: "Legit agencies take commission, not upfront fees." },
                { title: "Nanny / Caregiver", icon: Icons.User, color: "purple", tag: "Job Scam", hook: "Hired instantly without interview. Sends check for 'supplies'.", tech: "Check fraud.", defense: "Always meet in person or video call first." },
                { title: "Mystery Shopper", icon: Icons.ShoppingBag, color: "emerald", tag: "Job Scam", hook: "'Buy gift cards to test the store service.'", tech: "They ask for the card codes.", defense: "Mystery shoppers are never paid in advance by check." },

                // --- CATEGORY: SHOPPING / SOCIAL ---
                { title: "The Phantom Rental", icon: Icons.Home, color: "cyan", tag: "Housing", hook: "Cheap rent, landlord is 'missionary' abroad.", tech: "Stolen photos.", defense: "Reverse image search. Never pay before viewing." },
                { title: "The 'Hi Mum' Text", icon: Icons.MessageCircle, color: "green", tag: "Social", hook: "'Lost phone, this is my new number.'", tech: "Mass SMS phishing.", defense: "Call the OLD number to verify." },
                { title: "Facebook 'Courier'", icon: Icons.Box, color: "blue", tag: "Marketplace", hook: "'I am busy, sending a GLS/UPS courier with cash.'", tech: "Phishing link for 'insurance fee'.", defense: "Cash in person only. No couriers." },
                { title: "Pet Deposit Scam", icon: Icons.Heart, color: "orange", tag: "Shopping", hook: "Purebred puppy for free/cheap, just pay shipping.", tech: "Endless 'crate fees' and 'vaccine fees'.", defense: "Video call to see the puppy live." },
                { title: "Tinder Verification", icon: Icons.Heart, color: "pink", tag: "Dating", hook: "Match asks you to click a link to 'verify safety'.", tech: "Credit card phishing site.", defense: "Tinder verifies via selfie, not credit card." },
                { title: "Sextortion", icon: Icons.Video, color: "red", tag: "Blackmail", hook: "Video chat turns sexual, then they threaten to send recording to friends.", tech: "Screen recording.", defense: "Block immediately. Do NOT pay (they leak anyway)." },
                { title: "Wrong Number (Mandy)", icon: Icons.MessageCircle, color: "pink", tag: "Social", hook: "'Is this Annie? We met at the gym.' -> Friendship.", tech: "Pig Butchering lead-in.", defense: "Ignore random texts. Don't engage." },
                { title: "Amazon 'Brushing'", icon: Icons.Package, color: "orange", tag: "Shopping", hook: "Random cheap packages arrive at your house.", tech: "Seller boosting their own rating using your address.", defense: "Change passwords. Keep the free stuff." },
                { title: "Student Loan Forgiveness", icon: Icons.Book, color: "blue", tag: "Gov", hook: "Call: 'Qualify for Biden forgiveness today.'", tech: "Stealing FSA ID login.", defense: "Apply only at studentaid.gov." },
                { title: "Sugar Baby Scam", icon: Icons.DollarSign, color: "pink", tag: "Social", hook: "'I want to spoil you. What is your bank login to deposit checks?'", tech: "Money laundering / Account takeover.", defense: "Never share login credentials." },
                { title: "Fake Charity", icon: Icons.Heart, color: "red", tag: "Disaster", hook: "Donations for recent earthquake/war.", tech: "Lookalike websites.", defense: "Use CharityNavigator to verify orgs." },
                { title: "Counterfeit Merch", icon: Icons.ShoppingCart, color: "slate", tag: "Shopping", hook: "Ads for 90% off luxury goods.", tech: "Bait and switch (receive cheap knockoff).", defense: "If it's too good to be true, it is." },
                { title: "Discord Nitro Scam", icon: Icons.MessageSquare, color: "indigo", tag: "Gaming", hook: "DM: 'Free Nitro for 3 months, scan QR.'", tech: "QR Token Logging.", defense: "Never scan Discord QRs sent by strangers." },
                { title: "Steam Admin Scam", icon: Icons.MessageSquare, color: "blue", tag: "Gaming", hook: "'I accidentally reported your account. Talk to this admin.'", tech: "Fake admin steals account.", defense: "Steam admins never contact via chat." },
                { title: "Fake Influencer", icon: Icons.Instagram, color: "pink", tag: "Social", hook: "'You won the giveaway! Pay shipping.'", tech: "Impersonator accounts.", defense: "Check the handle spelling carefully." },
                { title: "Booking.com Diversion", icon: Icons.Map, color: "blue", tag: "Travel", hook: "Message inside app: 'Payment failed, use this link.'", tech: "Hacked hotel accounts.", defense: "Only pay through the platform's main button." },
                
            ].map((scam, i) => (
                <div key={i} className="scam-card group relative bg-slate-800 border border-slate-700 hover:border-indigo-500 rounded-2xl p-6 transition-all hover:shadow-2xl hover:-translate-y-1 flex flex-col">
                    {/* Color Accent Bar */}
                    <div className={`absolute top-0 left-0 right-0 h-1.5 rounded-t-2xl bg-${scam.color}-500`}></div>
                    
                    <div className="flex justify-between items-start mb-4 mt-2">
                        <div className={`p-3 rounded-xl bg-${scam.color}-500/10 text-${scam.color}-400`}>
                            <Icon path={scam.icon} size={24} />
                        </div>
                        <Badge color={scam.color}>{scam.tag}</Badge>
                    </div>

                    <h3 className="font-bold text-xl text-white mb-2 group-hover:text-indigo-400 transition-colors">{scam.title}</h3>
                    
                    <div className="space-y-4 flex-1">
                        <div className="bg-slate-900/50 p-3 rounded-lg border border-slate-700/50">
                            <p className="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">The Hook</p>
                            <p className="text-sm text-slate-300 leading-relaxed">"{scam.hook}"</p>
                        </div>
                        
                        <div>
                            <p className="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">The Technology</p>
                            <p className="text-sm text-slate-400">{scam.tech}</p>
                        </div>
                    </div>

                    <div className={`mt-6 pt-4 border-t border-${scam.color}-500/30`}>
                        <div className="flex items-center gap-2">
                            <Icon path={Icons.Shield} size={16} className={`text-${scam.color}-400`} />
                            <span className={`text-xs font-bold uppercase tracking-wide text-${scam.color}-400`}>Defense Protocol</span>
                        </div>
                        <p className="text-sm text-white mt-1 font-medium">{scam.defense}</p>
                    </div>
                </div>
            ))}
        </div>
    </div>
)}
                    </main>

                    {/* Course Modal with Quiz */}
                    <Modal isOpen={!!activeCourse} onClose={() => setActiveCourse(null)} title={activeCourse?.title}>
                        <div className="space-y-6">
                            <div className="flex items-center justify-between text-sm text-slate-500 border-b border-slate-800 pb-4">
                                <Badge color="blue">{activeCourse?.level}</Badge>
                                <span>{activeCourse?.duration} read time</span>
                            </div>
                            
                            <div className="space-y-4">
                                {activeCourse?.content.map((step, i) => (
                                    <div key={i} className="flex gap-4 p-4 rounded-xl bg-slate-800">
                                        <div className="flex-shrink-0 w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold text-sm">
                                            {i + 1}
                                        </div>
                                        <p className="text-slate-300 text-sm leading-relaxed pt-1.5">{step}</p>
                                    </div>
                                ))}
                            </div>

                            {/* UPDATED QUIZ SECTION - MULTI QUESTION SUPPORT */}
                            {activeCourse?.quizzes && (
                                <div className="mt-8 p-6 border-t-2 border-slate-700 bg-slate-800/50 rounded-xl">
                                    <h4 className="font-bold text-lg mb-4 flex items-center gap-2 text-white">
                                        <Icon path={Icons.Target} className="text-indigo-500" />
                                        Certification Exam ({activeCourse.quizzes.length} Questions)
                                    </h4>
                                    
                                    <div className="space-y-8">
                                        {activeCourse.quizzes.map((q, qIdx) => {
                                            // Check if this specific question has been answered in this session
                                            const isAnswered = quizAnswers[activeCourse.id]?.[qIdx] !== undefined;
                                            
                                            return (
                                                <div key={qIdx} className="p-4 bg-slate-900 rounded-lg border border-slate-700">
                                                    <p className="font-bold text-slate-200 mb-3 text-sm">
                                                        <span className="text-indigo-500 mr-2">Q{qIdx + 1}.</span> 
                                                        {q.question}
                                                    </p>
                                                    <div className="space-y-2">
                                                        {q.options.map((opt, oIdx) => (
                                                            <button 
                                                                key={oIdx}
                                                                disabled={isAnswered}
                                                                onClick={() => {
                                                                    // Get existing answers for this course, or empty object
                                                                    const currentAnswers = quizAnswers[activeCourse.id] || {};
                                                                    // Update state with new answer for this specific question index
                                                                    setQuizAnswers({
                                                                        ...quizAnswers,
                                                                        [activeCourse.id]: { ...currentAnswers, [qIdx]: oIdx }
                                                                    });
                                                                }}
                                                                className={`w-full text-left p-3 rounded-lg border transition-all text-sm flex justify-between items-center ${
                                                                    isAnswered 
                                                                        ? oIdx === q.answer 
                                                                            ? 'bg-green-900/30 border-green-500 text-green-300' // Correct answer
                                                                            : oIdx === quizAnswers[activeCourse.id][qIdx] 
                                                                                ? 'bg-red-900/30 border-red-500 text-red-300' // Wrong selection
                                                                                : 'opacity-50 border-transparent' 
                                                                        : 'bg-slate-800 border-slate-700 hover:border-indigo-500 text-slate-400 hover:text-white'
                                                                }`}
                                                            >
                                                                {opt}
                                                                {isAnswered && oIdx === q.answer && <Icon path={Icons.Check} size={16} />}
                                                                {isAnswered && oIdx === quizAnswers[activeCourse.id][qIdx] && oIdx !== q.answer && <Icon path={Icons.X} size={16} />}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>

                                    {/* Footer Stats */}
                                    <div className="mt-6 pt-4 border-t border-slate-700 flex justify-between items-center">
                                        <div className="text-sm text-slate-400">
                                            Score: <span className="text-white font-bold">
                                                {quizAnswers[activeCourse.id] ? Object.values(quizAnswers[activeCourse.id]).filter((ans, idx) => ans === activeCourse.quizzes[idx].answer).length : 0}
                                            </span> / {activeCourse.quizzes.length}
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="pt-4 flex justify-end">
                                <Button 
                                    onClick={() => { 
                                        const currentCourseAnswers = quizAnswers[activeCourse.id] || {};
                                        const totalCount = activeCourse.quizzes ? activeCourse.quizzes.length : 0;
                                        
                                        // Calculate score
                                        let score = 0;
                                        if (activeCourse.quizzes) {
                                            activeCourse.quizzes.forEach((q, idx) => {
                                                if (currentCourseAnswers[idx] === q.answer) score++;
                                            });
                                        }

                                        // Only award XP if they passed (e.g. > 50%)
                                        if (score > totalCount / 2) {
                                            setUserXP(p => p + activeCourse.xp); 
                                            alert(`Module Complete! You scored ${score}/${totalCount}. +${activeCourse.xp} XP`);
                                        } else {
                                            alert(`You scored ${score}/${totalCount}. Try again to earn XP.`);
                                        }
                                        setActiveCourse(null);
                                    }}
                                >
                                    Finish Module
                                </Button>
                            </div>
                        </div>
                    </Modal>

                    {/* Mobile Tab Bar */}
                    <div className="md:hidden fixed bottom-0 left-0 right-0 glass border-t border-slate-700 p-2 grid grid-cols-5 z-50 bg-slate-900/90">
                        {['home', 'visuals', 'text', 'voice', 'learn'].map(id => (
                            <button 
                                key={id} 
                                onClick={() => setView(id)}
                                className={`flex flex-col items-center justify-center p-2 rounded-xl transition-colors ${view === id ? 'text-indigo-600' : 'text-slate-400'}`}
                            >
                                <Icon path={id === 'home' ? Icons.Home : id === 'visuals' ? Icons.Eye : id === 'text' ? Icons.Search : id === 'voice' ? Icons.Mic : Icons.Book} />
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
    </script>
</body>
</html>